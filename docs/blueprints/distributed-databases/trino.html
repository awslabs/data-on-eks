<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-blueprints/distributed-databases/trino" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Deploying Trino on EKS | Data on EKS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/trino"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploying Trino on EKS | Data on EKS"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/data-on-eks/img/header-icon.png"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/trino"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/trino" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/trino" hreflang="x-default"><link rel="stylesheet" href="/data-on-eks/assets/css/styles.74de95c8.css">
<script src="/data-on-eks/assets/js/runtime~main.fa8a36b3.js" defer="defer"></script>
<script src="/data-on-eks/assets/js/main.c406318a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/data-on-eks/"><div class="navbar__logo"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/data-on-eks/docs/introduction/intro">Introduction</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/gen-ai">Gen AI</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/data-on-eks/docs/blueprints/amazon-emr-on-eks">Blueprints</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/bestpractices/intro">Best Practices</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/benchmarks/emr-on-eks">Benchmarks</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/resources/intro">Resources</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-on-eks/docs/category/aiml-on-eks">AI/ML on EKS</a><button aria-label="Expand sidebar category &#x27;AI/ML on EKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-on-eks/docs/category/data-analytics-on-eks">Data Analytics on EKS</a><button aria-label="Expand sidebar category &#x27;Data Analytics on EKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-on-eks/docs/category/amazon-emr-on-eks">Amazon EMR on EKS</a><button aria-label="Expand sidebar category &#x27;Amazon EMR on EKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-on-eks/docs/category/streaming-platforms-on-eks">Streaming Platforms on EKS</a><button aria-label="Expand sidebar category &#x27;Streaming Platforms on EKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-on-eks/docs/category/job-schedulers-on-eks">Job Schedulers on EKS</a><button aria-label="Expand sidebar category &#x27;Job Schedulers on EKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/data-on-eks/docs/category/distributed-databases-on-eks">Distributed Databases on EKS</a><button aria-label="Collapse sidebar category &#x27;Distributed Databases on EKS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/distributed-databases">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/distributed-databases/cloudnative-postgres">CloudNativePG PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/distributed-databases/pinot">Apache Pinot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/data-on-eks/docs/blueprints/distributed-databases/trino">Trino on EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/distributed-databases/clickhouse">ClickHouse</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/data-on-eks/docs/blueprints/troubleshooting">Troubleshooting</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/data-on-eks/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/data-on-eks/docs/category/distributed-databases-on-eks"><span itemprop="name">Distributed Databases on EKS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Trino on EKS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploying Trino on EKS</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p><a href="https://trino.io/" target="_blank" rel="noopener noreferrer">Trino</a> is an open-source, fast, distributed query engine designed to run SQL queries for big data analytics, over a multitude of data sources including Amazon S3, relational databases, distributed data stores and data warehouses.</p>
<p>When Trino executes a query, it does so by breaking up the execution into a hierarchy of stages, which are implemented as a series of tasks distributed over a network of Trino workers. A Trino cluster consists of a coordinator and many workers for parallel processing, which can be deployed as Kubernetes pods on an EKS cluster. The coordinator and the workers collaborate to access connected data sources, with schemas and references stored in a catalog. To access the data sources, you can use one of the many <a href="https://trino.io/docs/current/connector.html" target="_blank" rel="noopener noreferrer">connectors</a> provided by Trino to adapt Trino. Examples include as Hive, Iceberg and Kafka. More details about Trino project can be found on this <a href="https://trino.io" target="_blank" rel="noopener noreferrer">link</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="blueprint-solution">Blueprint Solution<a href="#blueprint-solution" class="hash-link" aria-label="Direct link to Blueprint Solution" title="Direct link to Blueprint Solution">​</a></h2>
<p>This blueprint will deploy Trino on an EKS cluster (Kubernetes version 1.29) with nodes provisioned using Karpenter (v0.34.0). To optimize on cost and performance, Karpenter will provision On-demand nodes for the Trino coordinator and EC2 Spot instances for Trino workers. With Trino&#x27;s multi-architectural container images, Karpenter <a href="https://karpenter.sh/v0.34/concepts/nodepools/" target="_blank" rel="noopener noreferrer">NodePool</a> will allow provisioning of nodes with EC2 instances from different cpu architectures including AWS Graviton based instances. Trino is deployed using the <a href="https://trinodb.github.io/charts/charts/trino/" target="_blank" rel="noopener noreferrer">official Helm chart</a>, with custom values provided for users to leverage Hive and Iceberg connectors. The examples will use Glue and Iceberg tables on AWS as the backend data source, using S3 as the storage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-the-solution">Deploying the Solution<a href="#deploying-the-solution" class="hash-link" aria-label="Direct link to Deploying the Solution" title="Direct link to Deploying the Solution">​</a></h2>
<p>Let&#x27;s go through the deployment steps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<p>Ensure that you have installed the following tools on your machine.</p>
<ol>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" target="_blank" rel="noopener noreferrer">aws cli</a></li>
<li><a href="https://Kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener noreferrer">kubectl</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/install-cli" target="_blank" rel="noopener noreferrer">terraform</a></li>
<li><a href="https://trino.io/docs/current/client/cli.html" target="_blank" rel="noopener noreferrer">Trino CLI client</a></li>
</ol>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Toggle to see installation steps of Trino CLI</summary><div><div class="collapsibleContent_i85q"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://repo1.maven.org/maven2/io/trino/trino-cli/427/trino-cli-427-executable.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv trino-cli-427-executable.jar trino</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x trino</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-eks-cluster-with-trino">Deploy the EKS Cluster with Trino<a href="#deploy-the-eks-cluster-with-trino" class="hash-link" aria-label="Direct link to Deploy the EKS Cluster with Trino" title="Direct link to Deploy the EKS Cluster with Trino">​</a></h3>
<p>First, clone the repository</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/awslabs/data-on-eks.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Navigate into <code>distributed-databases/trino</code> and run <code>install.sh</code> script. Enter, when prompted, the AWS region you want to provision the resources to (for example, <code>us-west-2</code>).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd data-on-eks/distributed-databases/trino</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./install.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-deployment">Verify Deployment<a href="#verify-deployment" class="hash-link" aria-label="Direct link to Verify Deployment" title="Direct link to Verify Deployment">​</a></h3>
<p>Verify the Amazon EKS Cluster</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#Select your own region where you deployed resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws eks describe-cluster --name trino-on-eks --region us-west-2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Update local kubeconfig so we can access kubernetes cluster (you can also get this command from the terraform output <code>configure_kubectl</code> )</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws eks update-kubeconfig --name trino-on-eks --region us-west-2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>First, let&#x27;s verify that we have worker nodes provisioned by Karpenter in the cluster. Let&#x27;s also see their availability zone and capacity type (on-demand or spot)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes --selector=karpenter.sh/nodepool=trino-sql-karpenter -L topology.kubernetes.io/zone -L karpenter.sh/capacity-type -L node.kubernetes.io/instance-type</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output">Output<a href="#output" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        STATUS   ROLES    AGE   VERSION               ZONE         CAPACITY-TYPE   INSTANCE-TYPE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-1-11-49.us-west-2.compute.internal    Ready    &lt;none&gt;   24m   v1.29.0-eks-5e0fdde   us-west-2b   on-demand       t4g.medium</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can see above that Karpenter provisioned on-demand node for running Trino coordinator.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For a distributed Big Data query engine like Trino which runs on a massively parallel processing cluster, it is recommended to deploy the cluster in same availability zone to avoid incurring high Inter-AZ Data Transfer costs. That&#x27;s why Karpenter NodePool has been configured to launch EKS nodes in same AZ</p></div></div>
<p>Now, let&#x27;s verify the coordinator and worker pods running in <code>trino</code> namespace</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --namespace=trino</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-1">Output<a href="#output-1" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                 READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trino-coordinator-5cfd685c8f-mchff   1/1     Running   0          37m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we will port-forward the trino service so it can be accessed locally</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n trino port-forward service/trino 8080:8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, lets access the Trino UI at <code>http://localhost:8080</code> through web browser and login with username <code>admin</code> in the login window as shown below:</p>
<p><img decoding="async" loading="lazy" alt="Trino UI Login" src="data:image/png;base64,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" width="411" height="328" class="img_ev3q"></p>
<p>Trino Web UI will show 0 active worker:</p>
<p><img decoding="async" loading="lazy" alt="Trino UI" src="/data-on-eks/assets/images/trino-ui-5e81c81fa39c68b3ba02a0a3b0d09383.PNG" width="1189" height="548" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-trino-for-database-querying-executions">Using Trino for database querying executions<a href="#using-trino-for-database-querying-executions" class="hash-link" aria-label="Direct link to Using Trino for database querying executions" title="Direct link to Using Trino for database querying executions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-1-using-the-hive-connector">Example #1: Using the Hive Connector<a href="#example-1-using-the-hive-connector" class="hash-link" aria-label="Direct link to Example #1: Using the Hive Connector" title="Direct link to Example #1: Using the Hive Connector">​</a></h3>
<p>In this example, we will set up a Hive metastore using AWS Glue, with the source data stored in S3, and crawler that will infer schema from it to build a Glue table.</p>
<p>Using Trino on EKS with the Glue connector, we will use Trino CLI to run sample SQL queries to retrieve data.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h4>
<p>Run the hive script from the <code>examples</code> directory to set up the blueprint S3 bucket with the 2022 NYC Taxi dataset (in Parquet), and build Glue metastore:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd examples/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./hive-setup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You will see some outputs to show progress, and if successful, will see the name of the Glue table that will store the metadata as <code>hive</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-queries">Running the queries<a href="#running-the-queries" class="hash-link" aria-label="Direct link to Running the queries" title="Direct link to Running the queries">​</a></h4>
<p>You should have the Trino CLI installed as part of the prerequisite. The blueprint has the Hive Connector configured with the bucket we set up in the previous section, so you should be able to query the data source without additional settings.</p>
<p>First, port-forward your trino service to access it locally, if you have closed the session from previous section:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n trino port-forward service/trino 8080:8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While the port-forward is running, open another terminal tab where you have Trino CLI and run the following command to access the coordinator:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./trino http://127.0.0.1:8080 --user admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once successful, you will be able to get a prompt to execute commands. You can use <code>help</code> command to see a list of supported commands.  The first command you run will trigger the auto-scaling of trino workers from 0 to 1, and take a couple minutes to complete.</p>
<p>For example:</p>
<p>To show a list of catalogs, run query - <code>SHOW CATALOGS;</code> and you can see <code>hive</code> and <code>iceberg</code> catalogs among others configured by the blueprint</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-2">Output<a href="#output-2" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> Catalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> iceberg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> tpcds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> tpch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(5 rows)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query 20240215_200117_00003_6jdxw, FINISHED, 1 node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Splits: 1 total, 1 done (100.00%)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0.49 [0 rows, 0B] [0 rows/s, 0B/s]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To see the schemas (databases) in Hive catalog, run query - <code>SHOW SCHEMAS FROM hive;</code> :</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-3">Output<a href="#output-3" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> information_schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> taxi_hive_database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2 rows)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s use <code>taxi_hive_database</code> and show table in this database -</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">USE hive.taxi_hive_database;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW TABLES;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-4">Output<a href="#output-4" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(1 row)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, to run a simple query to list items - <code>SELECT * FROM hive LIMIT 5;</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-5">Output<a href="#output-5" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vendorid |  tpep_pickup_datetime   |  tpep_dropoff_datetime  | passenger_count | trip_distance | ratecodeid | store_and_fwd_flag | pulocationid | dolocation&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------+-------------------------+-------------------------+-----------------+---------------+------------+--------------------+--------------+-----------&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1 | 2022-09-01 00:28:12.000 | 2022-09-01 00:36:22.000 |             1.0 |           2.1 |        1.0 | N                  |          100 |          2&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1 | 2022-11-01 00:24:49.000 | 2022-11-01 00:31:04.000 |             2.0 |           1.0 |        1.0 | N                  |          158 |          1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1 | 2022-11-01 00:37:32.000 | 2022-11-01 00:42:23.000 |             2.0 |           0.8 |        1.0 | N                  |          249 |          1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        2 | 2022-09-01 00:02:24.000 | 2022-09-01 00:09:39.000 |             1.0 |          1.32 |        1.0 | N                  |          238 |          1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        2 | 2022-09-01 00:47:25.000 | 2022-09-01 00:56:09.000 |             1.0 |          2.94 |        1.0 | N                  |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cleaning-up-hive-resources">Cleaning Up Hive Resources<a href="#cleaning-up-hive-resources" class="hash-link" aria-label="Direct link to Cleaning Up Hive Resources" title="Direct link to Cleaning Up Hive Resources">​</a></h4>
<ol>
<li>
<p>Exit from Trino CLI with <code>exit</code> command.</p>
</li>
<li>
<p>Run the cleanup script from the <code>examples</code> directory to delete all the resources created from the hive script:</p>
</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd data-on-eks/distributed-databases/trino/examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./hive-cleanup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-2-using-the-iceberg-connector">Example #2: Using the Iceberg Connector<a href="#example-2-using-the-iceberg-connector" class="hash-link" aria-label="Direct link to Example #2: Using the Iceberg Connector" title="Direct link to Example #2: Using the Iceberg Connector">​</a></h3>
<p>In this example, we will set up using Apache Iceberg with AWS Glue as the catalog type, and will store the data in Amazon S3 with PARQUET format.</p>
<p>Using Trino on EKS with the Iceberg connector, we will use Trino CLI to create the above resources and run sample SQL queries to insert and retrieve data.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-queries-1">Running the queries<a href="#running-the-queries-1" class="hash-link" aria-label="Direct link to Running the queries" title="Direct link to Running the queries">​</a></h4>
<ul>
<li>Let&#x27;s find out the S3 data bucket created by blueprint. We will use this bucket to store data in Iceberg tables in PARQUET format.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd data-on-eks/distributed-databases/trino</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BUCKET=$(terraform output --state=&quot;./terraform.tfstate&quot; --raw data_bucket)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $BUCKET</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-6">Output<a href="#output-6" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">trino-data-bucket-20240215180855515400000001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Let’s now create an Iceberg schema with tables populated with data from sf10000 schema tables of <a href="https://trino.io/docs/current/connector/tpcds.html" target="_blank" rel="noopener noreferrer">TPCDS</a>. We will use CREATE TABLE AS SELECT (CTAS) statements. The SQL file <code>examples/trino_sf10000_tpcds_to_iceberg.sql</code> has the below SQL statements:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use tpcds.sf10000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from tpcds.sf10000.item limit 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from tpcds.sf10000.warehouse limit 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Drop tables &amp; schema */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop schema iceberg.iceberg_schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.warehouse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.item;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.inventory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.date_dim;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Iceberg schema creation */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create schema if not exists iceberg.iceberg_schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with (LOCATION = &#x27;s3://trino-data-bucket-20240215180855515400000001/iceberg/&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Iceberg Table Creation with CTAS from tpcds tables */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table if not exists iceberg.iceberg_schema.inventory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with (FORMAT = &#x27;PARQUET&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">as select *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from tpcds.sf10000.inventory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table if not exists iceberg.iceberg_schema.date_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with (FORMAT = &#x27;PARQUET&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">as select d_date_sk,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_date_id as varchar(16)) as d_date_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_date,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_month_seq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_week_seq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_quarter_seq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_year,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_dow,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_moy,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_dom,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_qoy,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_fy_year,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_fy_quarter_seq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_fy_week_seq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_day_name as varchar(9)) as d_day_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_quarter_name as varchar(6)) as d_quarter_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_holiday as varchar(1)) as d_holiday,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_weekend as varchar(1)) as d_weekend,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_following_holiday as varchar(1)) as d_following_holiday,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_first_dom,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_last_dom,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_same_day_ly,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d_same_day_lq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_current_day as varchar(1)) as d_current_day,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_current_week as varchar(1)) as d_current_week,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_current_month as varchar(1)) as d_current_month,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(d_current_quarter as varchar(1)) as d_current_quarter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from tpcds.sf10000.date_dim;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table if not exists iceberg.iceberg_schema.warehouse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with (FORMAT = &#x27;PARQUET&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">as select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_warehouse_sk,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(w_warehouse_id as varchar(16)) as w_warehouse_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_warehouse_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_warehouse_sq_ft,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(w_street_number as varchar(10)) as w_street_number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_street_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(w_street_type as varchar(15)) as w_street_type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(w_suite_number as varchar(10)) as w_suite_number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_city,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_county,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(w_state as varchar(2)) as w_state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(w_zip as varchar(10)) as w_zip,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_country,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_gmt_offset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from tpcds.sf10000.warehouse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table if not exists iceberg.iceberg_schema.item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with (FORMAT = &#x27;PARQUET&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">as select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_item_sk,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_item_id as varchar(16)) as i_item_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_rec_start_date,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_rec_end_date,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_item_desc,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_current_price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_wholesale_cost,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_brand_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_brand as varchar(50)) as i_brand,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_class_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_class as varchar(50)) as i_class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_category_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_category as varchar(50)) as i_category,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_manufact_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_manufact as varchar(50)) as i_manufact,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_size as varchar(50)) as i_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_formulation as varchar(20)) as i_formulation,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_color as varchar(20)) as i_color,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_units as varchar(10)) as i_units,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_container as varchar(10)) as i_container,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i_manager_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(i_product_name as varchar(50)) as i_product_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from tpcds.sf10000.item;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Select from Iceberg table */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from iceberg.iceberg_schema.date_dim limit 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from iceberg.iceberg_schema.item limit 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from iceberg.iceberg_schema.inventory limit 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Running query from Iceberg table */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with inv as</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,stdev,mean, case mean when 0 then null else stdev/mean end cov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from iceberg.iceberg_schema.inventory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,iceberg.iceberg_schema.item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,iceberg.iceberg_schema.warehouse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,iceberg.iceberg_schema.date_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where inv_item_sk = i_item_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv_warehouse_sk = w_warehouse_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv_date_sk = d_date_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and d_year =1999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where case mean when 0 then 0 else stdev/mean end &gt; 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from inv inv1,inv inv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where inv1.i_item_sk = inv2.i_item_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv1.w_warehouse_sk = inv2.w_warehouse_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv1.d_moy=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv2.d_moy=4+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv1.cov &gt; 1.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov,inv2.d_moy,inv2.mean, inv2.cov;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>Above SQL commands will execute following actions:</p>
<ul>
<li>Create an Iceberg schema named <code>iceberg_schema</code></li>
<li>Create 4 Iceberg tables - <code>warehouse</code>, <code>item</code>, <code>inventory</code> and <code>date_dim</code> with data from same tables of tpcds</li>
<li>Query data from above Iceberg tables</li>
</ul>
</li>
<li>
<p>Let&#x27;s now execute above SQL commands using Trino CLI:</p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">envsubst &lt; examples/trino_sf10000_tpcds_to_iceberg.sql &gt; examples/iceberg.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./trino --file &#x27;examples/iceberg.sql&#x27; --server http://localhost:8080 --user admin --ignore-errors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>You can see completed and running SQL queries in Trino UI web monitor as below:</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Trino Queries" src="/data-on-eks/assets/images/trino-queries-726f33f8830f9fddb3c2f426486ce601.PNG" width="1323" height="881" class="img_ev3q"></p>
<ul>
<li>Let’s open another terminal and see how KEDA is scaling Trino worker pods, when above SQL commands are running:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get hpa -n trino -w</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-7">Output<a href="#output-7" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                REFERENCE                 TARGETS                MINPODS   MAXPODS   REPLICAS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   &lt;unknown&gt;/1, &lt;unknown&gt;/1 + 1 more...   1         15        0          37m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 1/1 + 1 more...                   1         15        1          38m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 500m/1 + 1 more...                1         15        1          40m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 0/1 + 1 more...                   1         15        1          40m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 0/1 + 1 more...                   1         15        1          40m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 0/1 + 1 more...                   1         15        1          40m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 0/1 + 1 more...                   1         15        2          41m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 0/1 + 1 more...                   1         15        2          41m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keda-hpa-keda-scaler-trino-worker   Deployment/trino-worker   0/1, 0/1 + 1 more...                   1         15        2          41m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see HPA scaling from initial 0 workers to 2 workers with increasing query load and average cpu utilization of workerss:</p>
<p><img decoding="async" loading="lazy" alt="Trino Scaling" src="/data-on-eks/assets/images/trino-workers-scaling-ef8ee4aec254bec584805aab502b9077.png" width="1177" height="727" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-3-optional-fault-tolerant-execution-in-trino">Example #3 (Optional): Fault-tolerant execution in Trino<a href="#example-3-optional-fault-tolerant-execution-in-trino" class="hash-link" aria-label="Direct link to Example #3 (Optional): Fault-tolerant execution in Trino" title="Direct link to Example #3 (Optional): Fault-tolerant execution in Trino">​</a></h3>
<p><a href="https://trino.io/docs/current/admin/fault-tolerant-execution.html" target="_blank" rel="noopener noreferrer">Fault-tolerant execution</a> is an opt-in mechanism in Trino that was implemented using <a href="https://trino.io/blog/2022/05/05/tardigrade-launch.html#what-is-project-tardigrade" target="_blank" rel="noopener noreferrer">Project Tardigrade</a>. Without fault-tolerant configuration, Trino query fails whenever any of the component tasks of the query fails due to any reason (for example, a worker node failure or termination). These failed queries have to be restarted from scratch resulting in longer execution time, compute wastage, and spend, especially for long-running queries.</p>
<p>When fault-tolerant execution is configured in Trino with a <a href="https://trino.io/docs/current/admin/fault-tolerant-execution.html#retry-policy" target="_blank" rel="noopener noreferrer">retry policy</a>, intermediate exchange data is spooled in an external storage like Amazon S3 or HDFS using <a href="https://trino.io/docs/current/admin/fault-tolerant-execution.html#exchange-manager" target="_blank" rel="noopener noreferrer">exchange manager</a>. Trino then retries failed query (if retry policy is configured as &quot;QUERY&quot;) or failed tasks (if retry policy is configured as &quot;TASK&quot;).  Trino&#x27;s remaining workers reuse exchange manager data to retry and complete query in the event of a worker outage or other fault during query execution.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>A <strong>QUERY retry policy</strong> instructs Trino to retry whole query when an error occurs on a worker node. It is recommended to use this retry policy when the majority of the workload for the Trino cluster comprises many small queries.</p><p>A <strong>TASK retry policy</strong> instructs Trino to retry individual tasks in the event of failure. It is recommended to use this policy when Trino executes large batch queries. The cluster can more efficiently retry smaller tasks within the query rather than retry the whole query.</p></div></div>
<ul>
<li>This blueprint has deployed Trino cluster with fault-tolerant configuration with a <code>TASK</code> retry policy in <strong><code>config.properties</code></strong> file in coordinator and worker pods. Let&#x27;s verify that by opening a bash command shell inside coordinator pod:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">COORDINATOR_POD=$(kubectl get pods -l &quot;app.kubernetes.io/instance=trino,app.kubernetes.io/component=coordinator&quot; -o name -n trino)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec --stdin --tty $COORDINATOR_POD -n trino -- /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/trino/config.properties</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-8">Output<a href="#output-8" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">coordinator=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-scheduler.include-coordinator=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http-server.http.port=8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query.max-memory=280GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query.max-memory-per-node=22GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discovery.uri=http://localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retry-policy=TASK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange.compression-enabled=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query.low-memory-killer.delay=0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query.remote-task.max-error-duration=1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query.hash-partition-count=50</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Blueprint has also configured exchange manager using an Amazon S3 bucket in <strong><code>exchange-manager.properties</code></strong> file in coordinator and worker pods. Let&#x27;s also verify that inside coordinator pod</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/trino/exchange-manager.properties</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="output-9">Output<a href="#output-9" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">exchange-manager.name=filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange.base-directories=s3://trino-exchange-bucket-20240215180855570800000004</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange.s3.region=us-west-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange.s3.iam-role=arn:aws:iam::xxxxxxxxxx:role/trino-sa-role</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Please note down exchange manager S3 bucket name from above. You can explore contents of above S3 bucket in AWS Console. It will be empty when no query is running.</p>
<ul>
<li>Now, let&#x27;s exit from bash shell of the coordinator pod</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With below steps, we will now test fault-tolerant execution by running a <code>select</code> query and terminate few Trino workers when query is still running.</p>
<ul>
<li>Find the file <code>trino_select_query_iceberg.sql</code> file in the <code>examples</code> folder, which contains the SQL commands below:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">with inv as</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,stdev,mean, case mean when 0 then null else stdev/mean end cov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from iceberg.iceberg_schema.inventory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,iceberg.iceberg_schema.item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,iceberg.iceberg_schema.warehouse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,iceberg.iceberg_schema.date_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where inv_item_sk = i_item_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv_warehouse_sk = w_warehouse_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv_date_sk = d_date_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and d_year =1999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where case mean when 0 then 0 else stdev/mean end &gt; 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from inv inv1,inv inv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where inv1.i_item_sk = inv2.i_item_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv1.w_warehouse_sk = inv2.w_warehouse_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv1.d_moy=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv2.d_moy=4+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and inv1.cov &gt; 1.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov,inv2.d_moy,inv2.mean, inv2.cov;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Let&#x27;s now run select query first</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./trino --file &#x27;examples/trino_select_query_iceberg.sql&#x27; --server http://localhost:8080 --user admin --ignore-errors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Immediately after above command, when above query is still running, open another terminal and scale down worker pods to just 1 worker, terminating all other workers with command below:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale deployment trino-worker -n trino --replicas=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See Trino Web UI on browser and there is only 1 active worker running now as other workers are terminated:</p>
<p><img decoding="async" loading="lazy" alt="Terminated workers" src="/data-on-eks/assets/images/trino-ft-terminated-workers-21fd4be7a3bf884adb75e591d122a33e.png" width="1401" height="777" class="img_ev3q"></p>
<ul>
<li>Go to Amazon S3 console and verify intermediate exchange data spooling in exchange manager S3 bucket with a name starting with <code>trino-exchange-bucket</code>.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Exchange manager" src="/data-on-eks/assets/images/trino-exchange-manager-c5bcae7d73c134f3b2ef63a3556dc7e2.png" width="910" height="765" class="img_ev3q"></p>
<ul>
<li>Let&#x27;s now see Trino Web UI monitor again to verify completion of the query despite of 6 failed tasks due to terminated workers (we have encircled them in RED in the screenshot below).</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Please note, number of failed tasks could be different in your Trino Web UI depending upon how many tasks were running on workers that got terminated.</p><p>Also you can see different number of active workers depending upon worker pods scaled by Horizontal Pod Autoscaler(HPA) using cpu utilization metric</p></div></div>
<p><img decoding="async" loading="lazy" alt="Trino query completion" src="/data-on-eks/assets/images/trino-ft-query-completion-6ea7e16b71d58da2e8fdc8639de62fac.png" width="1425" height="779" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cleaning-up-iceberg-resources">Cleaning Up Iceberg Resources<a href="#cleaning-up-iceberg-resources" class="hash-link" aria-label="Direct link to Cleaning Up Iceberg Resources" title="Direct link to Cleaning Up Iceberg Resources">​</a></h4>
<ol>
<li>Let&#x27;s open Trino CLI</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./trino http://127.0.0.1:8080 --user admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Now, let&#x27;s delete Iceberg tables and schema by running below SQL commands on Trino CLI:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.warehouse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.item;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.inventory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table iceberg.iceberg_schema.date_dim;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop schema iceberg.iceberg_schema;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Exit from Trino CLI with <code>exit</code> command.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cleanup-">Cleanup 🧹<a href="#cleanup-" class="hash-link" aria-label="Direct link to Cleanup 🧹" title="Direct link to Cleanup 🧹">​</a></h2>
<p>To delete all the components provisioned as part of this blueprint, using the following command to destroy all the resources.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd data-on-eks/distributed-databases/trino</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./cleanup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>To avoid unwanted charges to your AWS account, delete all the AWS resources created during this deployment</p><p>ex. S3 buckets for Trino Exchange manager</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Trino is a tool for fast querying vast amounts of data from your data sources.In this example, we shared a terraform based blueprint that deploys Trino with fault-tolerant configuration on Amazon EKS, with add-ons necessary to build a complete EKS cluster (i.e. Karpenter for node autoscaling, Metrics server and HPA for Trino worker pods autoscaling, monitoring with Prometheus/Grafana stack). Among many features, we highlighted a couple of examples on creating an Iceberg or Hive data store using Amazon S3 as storage, and running simple Trino queries for results. We also deployed and scaled Trino workers on Spot instances for cost optimization. We also demonstrated fault-tolerant feature of Trino, which makes it suitable for Spot instances to save costs for long-running batch queries.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/blueprints/distributed-databases/trino.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/data-on-eks/docs/blueprints/distributed-databases/pinot"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Apache Pinot</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/data-on-eks/docs/blueprints/distributed-databases/clickhouse"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ClickHouse</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#blueprint-solution" class="table-of-contents__link toc-highlight">Blueprint Solution</a></li><li><a href="#deploying-the-solution" class="table-of-contents__link toc-highlight">Deploying the Solution</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#deploy-the-eks-cluster-with-trino" class="table-of-contents__link toc-highlight">Deploy the EKS Cluster with Trino</a></li><li><a href="#verify-deployment" class="table-of-contents__link toc-highlight">Verify Deployment</a></li></ul></li><li><a href="#using-trino-for-database-querying-executions" class="table-of-contents__link toc-highlight">Using Trino for database querying executions</a><ul><li><a href="#example-1-using-the-hive-connector" class="table-of-contents__link toc-highlight">Example #1: Using the Hive Connector</a></li><li><a href="#example-2-using-the-iceberg-connector" class="table-of-contents__link toc-highlight">Example #2: Using the Iceberg Connector</a></li><li><a href="#example-3-optional-fault-tolerant-execution-in-trino" class="table-of-contents__link toc-highlight">Example #3 (Optional): Fault-tolerant execution in Trino</a></li></ul></li><li><a href="#cleanup-" class="table-of-contents__link toc-highlight">Cleanup 🧹</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Get Started</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/data-on-eks/docs/introduction/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Get Involved</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS  <br> © 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;7fbc7ab02fae4767b1af2588eba0cdf2&quot;}"></script></div>
</body>
</html>