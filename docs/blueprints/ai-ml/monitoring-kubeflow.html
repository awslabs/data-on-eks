<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-blueprints/ai-ml/monitoring-kubeflow">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Monitor Machine Learning workflows with Kubeflow on Amazon EKS | Data on EKS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/data-on-eks/docs/blueprints/ai-ml/monitoring-kubeflow"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Monitor Machine Learning workflows with Kubeflow on Amazon EKS | Data on EKS"><meta data-rh="true" name="description" content="As part of day 2 operations, customers want to monitor their Infrastructure, Amazon EKS clusters and application components. AWS customers use Amazon EKS to run machine learning workloads. Containerization allows machine learning engineers to package and distribute models easily, while Kubernetes helps in deploying, scaling, and improving. In addition to monitoring the behavior of the Amazon EKS clusters, it’s essential to monitor the behavior of machine learning workflows as well to ensure the operational resilience of workloads and platforms run by an organization."><meta data-rh="true" property="og:description" content="As part of day 2 operations, customers want to monitor their Infrastructure, Amazon EKS clusters and application components. AWS customers use Amazon EKS to run machine learning workloads. Containerization allows machine learning engineers to package and distribute models easily, while Kubernetes helps in deploying, scaling, and improving. In addition to monitoring the behavior of the Amazon EKS clusters, it’s essential to monitor the behavior of machine learning workflows as well to ensure the operational resilience of workloads and platforms run by an organization."><link data-rh="true" rel="icon" href="/data-on-eks/img/header-icon.png"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/data-on-eks/docs/blueprints/ai-ml/monitoring-kubeflow"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/blueprints/ai-ml/monitoring-kubeflow" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/blueprints/ai-ml/monitoring-kubeflow" hreflang="x-default"><link rel="stylesheet" href="/data-on-eks/assets/css/styles.12e8a398.css">
<link rel="preload" href="/data-on-eks/assets/js/runtime~main.0a31b3b0.js" as="script">
<link rel="preload" href="/data-on-eks/assets/js/main.32556954.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/data-on-eks/"><div class="navbar__logo"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/data-on-eks/docs/introduction/intro">Introduction</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/data-on-eks/docs/blueprints/amazon-emr-on-eks">Blueprints</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/bestpractices/intro">Best Practices</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/benchmarks/emr-on-eks">Benchmarks</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/workshop/intro">Workshop</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/resources/intro">Resources</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/amazon-emr-on-eks">Amazon EMR on EKS</a><button aria-label="Toggle the collapsible sidebar category &#x27;Amazon EMR on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/data-analytics-on-eks">Data Analytics on EKS</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Analytics on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/data-on-eks/docs/category/aiml-on-eks">AI/ML on EKS</a><button aria-label="Toggle the collapsible sidebar category &#x27;AI/ML on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/ai-ml">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/ai-ml/ray">Ray on EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/ai-ml/emr-spark-rapids">EMR NVIDIA Spark-RAPIDS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/ai-ml/kubeflow">Kubeflow on AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/ai-ml/jupyterhub">JupyterHub on EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/data-on-eks/docs/blueprints/ai-ml/monitoring-kubeflow">Observability for Kubeflow on EKS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/job-schedulers-on-eks">Job Schedulers on EKS</a><button aria-label="Toggle the collapsible sidebar category &#x27;Job Schedulers on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/streaming-platforms-on-eks">Streaming Platforms on EKS</a><button aria-label="Toggle the collapsible sidebar category &#x27;Streaming Platforms on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/distributed-databases-on-eks">Distributed Databases on EKS</a><button aria-label="Toggle the collapsible sidebar category &#x27;Distributed Databases on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/data-on-eks/docs/blueprints/troubleshooting">Troubleshooting</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/data-on-eks/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/data-on-eks/docs/category/aiml-on-eks"><span itemprop="name">AI/ML on EKS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Observability for Kubeflow on EKS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Monitor Machine Learning workflows with Kubeflow on Amazon EKS</h1><p>As part of day 2 operations, customers want to monitor their Infrastructure, Amazon EKS clusters and application components. AWS customers use Amazon EKS to run machine learning workloads. Containerization allows machine learning engineers to package and distribute models easily, while Kubernetes helps in deploying, scaling, and improving. In addition to monitoring the behavior of the Amazon EKS clusters, it’s essential to monitor the behavior of machine learning workflows as well to ensure the operational resilience of workloads and platforms run by an organization.</p><p><a href="https://www.kubeflow.org/" target="_blank" rel="noopener noreferrer">Kubeflow</a> is the open-source machine learning (ML) platform dedicated to making deployments of machine learning (ML) workflows on Kubernetes simple, portable and scalable. Kubeflow provides many components, including a central dashboard, multi-user Jupyter notebooks, Kubeflow Pipelines, KFServing, and Katib, as well as distributed training operators for <a href="https://www.tensorflow.org/" target="_blank" rel="noopener noreferrer">TensorFlow</a>, <a href="https://pytorch.org/" target="_blank" rel="noopener noreferrer">PyTorch</a>, <a href="https://mxnet.apache.org/versions/1.9.1/" target="_blank" rel="noopener noreferrer">MXNet</a>, and <a href="https://xgboost.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">XGBoost</a>. Kubeflow components export metrics which provides insights into the health and function of Kubeflow on <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">Amazon Elastic Kubernetes Service (EKS)</a>.</p><p><a href="https://opentelemetry.io/docs/concepts/what-is-opentelemetry/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a> is a set of APIs, SDKs, and tools that are designed for the creation and management of telemetry data such as traces, metrics, and logs. <a href="https://github.com/aws-observability/aws-otel-collector" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry Collector (ADOT Collector)</a> is an AWS-supported version of the upstream OpenTelemetry Collector that is fully compatible with AWS computing platforms, including EKS. It enables users to send telemetry data to AWS managed services such as Amazon CloudWatch, Amazon Managed Service for Prometheus, and AWS X-Ray. In this post, We’ll show how you can configure an <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">Amazon Elastic Kubernetes Service (Amazon EKS)</a> cluster with Kubeflow, <a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a>, and<a href="https://aws.amazon.com/grafana/" target="_blank" rel="noopener noreferrer">Amazon Managed Grafana</a> using <a href="https://aws-otel.github.io/docs/introduction" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a> for monitoring your Kubeflow machine learning workflows.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture"><strong>Architecture</strong><a href="#architecture" class="hash-link" aria-label="Direct link to architecture" title="Direct link to architecture">​</a></h2><p>The following diagram shows the complete setup that we will walk through in this walk through:</p><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-1-fd998378bf1f1fc7e9045c9a225ebaf2.jpg" width="1012" height="974" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-walkthrough">Solution Walkthrough<a href="#solution-walkthrough" class="hash-link" aria-label="Direct link to Solution Walkthrough" title="Direct link to Solution Walkthrough">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3><p>You will need the following to complete the steps in this post:</p><ul><li>An <a href="https://awslabs.github.io/kubeflow-manifests/docs/deployment/prerequisites/" target="_blank" rel="noopener noreferrer">Ubuntu development environment</a> with access to an AWS environment</li><li>Install <a href="https://github.com/okigan/awscurl" target="_blank" rel="noopener noreferrer">awscurl</a> which is a curl-like tool with AWS Signature Version 4 request signing on your environment</li></ul><p>First, Let’s start by setting a few environment variables:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KFL_EKS_CLUSTER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">KFL-EKS-CLUSTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KFL_EKS_CLUSTER_V</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1.25</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KFL_ACCOUNT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">aws sts get-caller-identity --query </span><span class="token variable string" style="color:#e3116c">&#x27;Account&#x27;</span><span class="token variable" style="color:#36acaa"> --output text</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KFL_AWS_REGION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">us-west-2 </span><span class="token comment" style="color:#999988;font-style:italic"># Your AWS Region</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AWS_REGION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">us-west-2 </span><span class="token comment" style="color:#999988;font-style:italic"># Your AWS Region</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KFL_AMP_WORKSPACE_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubeflow-amp-workshop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CLUSTER_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">KFL-EKS-CLUSTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CLUSTER_REGION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">us-west-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBEFLOW_RELEASE_VERSION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">v1.7.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AWS_RELEASE_VERSION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">v1.7.0-aws-b1.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, let&#x27;s start with installing prerequisites such as <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" target="_blank" rel="noopener noreferrer">AWS CLI version 2</a>, <a href="https://eksctl.io/introduction/#installation" target="_blank" rel="noopener noreferrer">eksctl</a>, <a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html" target="_blank" rel="noopener noreferrer">kubectl</a>, <a href="https://www.python.org/downloads/release/python-389/" target="_blank" rel="noopener noreferrer">python3.8</a>, <a href="https://mikefarah.gitbook.io/yq/" target="_blank" rel="noopener noreferrer">yq</a>, <a href="https://stedolan.github.io/jq/download/" target="_blank" rel="noopener noreferrer">jq</a>, <a href="https://github.com/okigan/awscurl" target="_blank" rel="noopener noreferrer">awscurl,</a><a href="https://kubectl.docs.kubernetes.io/installation/kustomize/" target="_blank" rel="noopener noreferrer">kustomize version 5+</a> required to run the demonstration. Clone the <code>awslabs/kubeflow-manifests</code> <a href="https://github.com/awslabs/kubeflow-manifests" target="_blank" rel="noopener noreferrer">repo</a> and checkout a release. Substitute the value for <code>AWS_RELEASE_VERSION</code> with <code>v1.7.0-aws-b1.0.1</code> and run the following command. Read more about <a href="https://github.com/awslabs/kubeflow-manifests/blob/v1.3-branch/distributions/aws/examples/README.md#releases-and-versioning" target="_blank" rel="noopener noreferrer">releases and versioning</a> policy to determine the right version for you for installing Kubeflow.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/awslabs/kubeflow-manifests.git </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> kubeflow-manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout </span><span class="token variable" style="color:#36acaa">${AWS_RELEASE_VERSION}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone --branch </span><span class="token variable" style="color:#36acaa">${KUBEFLOW_RELEASE_VERSION}</span><span class="token plain"> https://github.com/kubeflow/manifests.git upstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">make</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">install</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">-</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">tools</span><span class="token variable" style="color:#36acaa">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-eks-cluster">Create an EKS Cluster<a href="#create-an-eks-cluster" class="hash-link" aria-label="Direct link to Create an EKS Cluster" title="Direct link to Create an EKS Cluster">​</a></h3><p>Let’s create an Amazon EKS cluster using <code>eksctl</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## eksctl Cluster creation command for EKS cluster.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl create cluster </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --version </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER_V</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region </span><span class="token variable" style="color:#36acaa">$KFL_AWS_REGION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --nodegroup-name linux-nodes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-type m5.xlarge </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --nodes </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --nodes-min </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --nodes-max </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --managed </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --with-oidc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-amazon-elastic-block-store-ebs-container-storage-interface-driver">Installing <strong>Amazon Elastic Block Store (EBS) Container Storage Interface Driver</strong><a href="#installing-amazon-elastic-block-store-ebs-container-storage-interface-driver" class="hash-link" aria-label="Direct link to installing-amazon-elastic-block-store-ebs-container-storage-interface-driver" title="Direct link to installing-amazon-elastic-block-store-ebs-container-storage-interface-driver">​</a></h3><p>A <a href="https://kubernetes.io/blog/2019/01/15/container-storage-interface-ga/" target="_blank" rel="noopener noreferrer">Container Storage Interface (CSI) driver</a> is needed in order to get your <code>PersisentVolumeClaims</code> served by a <code>PersistentVolume</code>. Please run the following commands to create Amazon EBS CSI driver IAM role and add EBS CSI add-on :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">eksctl create iamserviceaccount </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name ebs-csi-controller-sa </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --namespace kube-system </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --approve </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --role-only </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --role-name AmazonEKS_EBS_CSI_DriverRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl create addon </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name aws-ebs-csi-driver </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --service-account-role-arn arn:aws:iam::</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">aws sts get-caller-identity --query Account --output text</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">:role/AmazonEKS_EBS_CSI_DriverRole </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-kubeflow">Installing Kubeflow<a href="#installing-kubeflow" class="hash-link" aria-label="Direct link to Installing Kubeflow" title="Direct link to Installing Kubeflow">​</a></h3><p>You can install all Kubeflow official components (residing under <code>apps</code>) and all common services (residing under <code>common</code>) using the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> deploy-kubeflow </span><span class="token assign-left variable" style="color:#36acaa">INSTALLATION_OPTION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kustomize </span><span class="token assign-left variable" style="color:#36acaa">DEPLOYMENT_OPTION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vanilla</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It takes around 5 minutes for all components to get installed. Once everything is installed successfully, you can access the Kubeflow Central Dashboard. <a href="https://awslabs.github.io/kubeflow-manifests/" target="_blank" rel="noopener noreferrer">Kubeflow on AWS</a> page has more information for learning open source distribution of <a href="https://www.kubeflow.org/" target="_blank" rel="noopener noreferrer">Kubeflow</a>  on AWS.</p><p>After installation, it will take some time for all Pods to become ready. Make sure all Pods are ready before trying to connect, otherwise you might get unexpected errors. To check that all Kubeflow-related Pods are ready, use the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -A -o json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq -r </span><span class="token string" style="color:#e3116c">&#x27;.items[] | select(.metadata.namespace==&quot;cert-manager&quot; or &quot;istio-system&quot; or &quot;auth&quot; or &quot;knative-eventing&quot; or &quot;knative-serving&quot; or &quot;kubeflow&quot; or &quot;kubeflow-user-example-com&quot;) | .metadata.namespace + &quot;|&quot; + .metadata.name + &quot;|&quot; + .status.phase&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-kubeflow-central-dashboard">Accessing Kubeflow Central Dashboard<a href="#accessing-kubeflow-central-dashboard" class="hash-link" aria-label="Direct link to Accessing Kubeflow Central Dashboard" title="Direct link to Accessing Kubeflow Central Dashboard">​</a></h3><p>Kubeflow can be accessed via port-forward and this enables you to get started quickly without imposing any requirements on your environment. Run the following to port-forward Istio&#x27;s Ingress-Gateway to local port <code>8080</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward svc/istio-ingressgateway -n istio-system </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After running the command, you can access the Kubeflow Central Dashboard by doing the following:</p><ol><li>Dex is an OpenID Connect Identity (OIDC) with multiple authentication backends. Open your browser and visit <code>http://localhost:8080</code> and You should get the Dex login screen.</li><li>Login with the default user&#x27;s credential. The default email address is <code>user@example.com</code> and the default password is <code>12341234</code>.</li></ol><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-2-abb24d176d064dccf8e46eb08429d685.jpg" width="3554" height="1550" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-amazon-managed-service-for-prometheus">Setup Amazon Managed Service for Prometheus<a href="#setup-amazon-managed-service-for-prometheus" class="hash-link" aria-label="Direct link to Setup Amazon Managed Service for Prometheus" title="Direct link to Setup Amazon Managed Service for Prometheus">​</a></h3><p>A workspace in <a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a> is a logical and isolated Prometheus server dedicated to Prometheus resources such as metrics. A workspace supports fine-grained access control for authorizing its management such as update, list, describe, delete, and the ingestion and querying of metrics.</p><p>Please open a new terminal window and setup all environment variables as you did in start of the demonstration. Please use the below command to create an Amazon Managed Service for Prometheus workspace.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws amp create-workspace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --alias </span><span class="token variable" style="color:#36acaa">$KFL_AMP_WORKSPACE_NAME</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region </span><span class="token variable" style="color:#36acaa">$KFL_AWS_REGION</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Amazon Managed Service for Prometheus  workspace should be created in just a few seconds.</p><p>As a best practice, create a <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/create-interface-endpoint.html" target="_blank" rel="noopener noreferrer">VPC endpoint</a>for Amazon Managed Service for Prometheus in VPC running your Amazon EKS cluster. Please visit <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-and-interface-VPC.html" target="_blank" rel="noopener noreferrer">Using Amazon Managed Service for Prometheus with interface VPC endpoints</a> for more information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-aws-distro-for-opentelemetry-adot-collector-to-ingest-metrics">Setting up the AWS Distro for OpenTelemetry (ADOT) Collector to Ingest Metrics<a href="#setting-up-the-aws-distro-for-opentelemetry-adot-collector-to-ingest-metrics" class="hash-link" aria-label="Direct link to Setting up the AWS Distro for OpenTelemetry (ADOT) Collector to Ingest Metrics" title="Direct link to Setting up the AWS Distro for OpenTelemetry (ADOT) Collector to Ingest Metrics">​</a></h3><p>Amazon Managed Service for Prometheus does not directly scrape operational metrics from containerized workloads in a Kubernetes or ECS cluster. It requires users to deploy a collection agent such as Prometheus server or an OpenTelemetry agent such as the AWS Distro for OpenTelemetry Collector in their cluster to perform this task.</p><p>One of the easiest ways to collect Prometheus metrics from Amazon EKS workloads is by using the <a href="https://aws-otel.github.io/docs/getting-started/collector" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT) collector</a>. Customers can deploy the ADOT Collector in a variety of deployment models and easily manage configuration using the ADOT Operator. The <a href="https://docs.aws.amazon.com/eks/latest/userguide/opentelemetry.html" target="_blank" rel="noopener noreferrer">ADOT Operator is also available as an EKS Add-On</a>for easier deployment and management. Read our <a href="https://aws.amazon.com/blogs/containers/metrics-and-traces-collection-using-amazon-eks-add-ons-for-aws-distro-for-opentelemetry/" target="_blank" rel="noopener noreferrer">launch blog</a>to learn about this feature.</p><p>The best way to provision permissions for resources running on EKS clusters is through <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IRSA</a>. The command below will use AWS CloudFormation to create a K8s namespace called <code>prometheus</code>, create a K8s Service Account called <code>amp-iamproxy-ingest-role</code>, create a new IAM Role with the <code>AmazonPrometheusRemoteWriteAccess</code> policy attached to it. It will also create a trust policy between the EKS cluster&#x27;s IAM OpenID Connect Provider (OIDC) and the created Service Account. See <a href="https://eksctl.io/usage/iamserviceaccounts/" target="_blank" rel="noopener noreferrer">this link</a> to learn more about this command.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl create iamserviceaccount </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name amp-iamproxy-ingest-role </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --namespace prometheus </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --attach-policy-arn arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --approve </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">--override-existing-serviceaccounts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, we will grant permissions to Amazon EKS add-ons to install ADOT and then we will installing the ADOT Add-on :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://amazon-eks.s3.amazonaws.com/docs/addons-otel-permissions.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws eks create-addon </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --addon-name adot </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster-name </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, wait for 30 seconds and execute the following command. You should see <code>&quot;ACTIVE&quot;</code> as result indicating that the add-on is installed successfully.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws eks describe-addon </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --addon-name adot </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster-name </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq .addon.status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, we will Install the OTel Collector Custom Resource Definition(CRD) and then we will configure the ADOT collector to push metrics to Amazon Managed Service for Prometheus endpoint.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">KFL_WORKSPACE_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">aws amp list-workspaces </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  --alias $KFL_AMP_WORKSPACE_NAME </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  --region</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$</span><span class="token variable punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">KFL_AWS_REGION</span><span class="token variable punctuation" style="color:#393A34">}</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  --query </span><span class="token variable string" style="color:#e3116c">&#x27;workspaces[0].[workspaceId]&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  --output text</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">KFL_AMP_ENDPOINT_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">aws amp describe-workspace </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  --workspace-id $KFL_WORKSPACE_ID </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> jq .workspace.prometheusEndpoint -r</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">KFL_AMP_REMOTE_WRITE_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${KFL_AMP_ENDPOINT_URL}</span><span class="token plain">api/v1/remote_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -O https://raw.githubusercontent.com/aws-samples/one-observability-demo/main/PetAdoptions/cdk/pet_stack/resources/otel-collector-prometheus.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i -e s/AWS_REGION/</span><span class="token variable" style="color:#36acaa">$KFL_AWS_REGION</span><span class="token plain">/g otel-collector-prometheus.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i -e s^AMP_WORKSPACE_URL^</span><span class="token variable" style="color:#36acaa">$KFL_AMP_REMOTE_WRITE_URL</span><span class="token plain">^g otel-collector-prometheus.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f ./otel-collector-prometheus.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, lets verify that the ADOT collector is running and you should see a result like the one below showing that the collector has been successfully installed and being ready.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get all -n prometheus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                           READY   STATUS    RESTARTS   AGEpod/observability-collector-5774bbc68d-7nj54   1/1     Running   0          59s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/observability-collector-monitoring   ClusterIP   10.100.114.1   &lt;none&gt;        8888/TCP   59s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/observability-collector   1/1     1            1           59s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                 DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/observability-collector-5774bbc68d   1         1         1       59s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now you have successfully deployed the ADOT Collector to collect metrics from the EKS cluster and send it to the Amazon Managed Service for Prometheus workspace you created. To test whether Amazon Managed Service for Prometheus received the metrics, use <code>awscurl</code>. This tool enables you to send HTTP requests through the command line with AWS Sigv4 authentication, so you must have AWS credentials set up locally with the correct permissions to query from Amazon Managed Service for Prometheus. For instructions on installing awscurl, see <a href="https://github.com/okigan/awscurl" target="_blank" rel="noopener noreferrer">awscurl</a>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">awscurl --service</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;aps&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --region</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$KFL_AWS_REGION</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://aps-workspaces.</span><span class="token string variable" style="color:#36acaa">$KFL_AWS_REGION</span><span class="token string" style="color:#e3116c">.amazonaws.com/workspaces/</span><span class="token string variable" style="color:#36acaa">$KFL_WORKSPACE_ID</span><span class="token string" style="color:#e3116c">/api/v1/query?query=istio_requests_total&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Your results should look similar to shown below:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;resultType&quot;: &quot;vector&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;result&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;metric&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;__name__&quot;: &quot;istio_requests_total&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;app&quot;: &quot;istio-ingressgateway&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;chart&quot;: &quot;gateways&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ....................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ....................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;version&quot;: &quot;v1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;value&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    1647974689.212,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amazon-managed-grafana-setup">Amazon Managed Grafana Setup<a href="#amazon-managed-grafana-setup" class="hash-link" aria-label="Direct link to Amazon Managed Grafana Setup" title="Direct link to Amazon Managed Grafana Setup">​</a></h3><p>Two steps are necessary for setting up AWS IAM Identity Center, setting up and logging in to Amazon Managed Grafana, and querying metrics from Amazon Managed Service for Prometheus workspace from the post. To set up Authentication and Authorization, follow the instructions in the <a href="https://docs.aws.amazon.com/grafana/latest/userguide/AMG-manage-users-and-groups-AMG.html" target="_blank" rel="noopener noreferrer">Amazon Managed Grafana User Guide</a> for enabling AWS IAM Identity Center. Second, setup the data source for <a href="https://docs.aws.amazon.com/grafana/latest/userguide/AMP-adding-AWS-config.html" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a>. You may also reference <a href="https://aws.amazon.com/blogs/mt/monitor-istio-on-eks-using-amazon-managed-prometheus-and-amazon-managed-grafana/#:~:text=AWS%20Single%20Sign%2DOn%20(SSO)" target="_blank" rel="noopener noreferrer">Monitor Istio on EKS using Amazon Managed Prometheus and Amazon Managed Grafana</a> blog, starting from the AWS Single Sign-On (SSO) section for Amazon Managed Grafana setup.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-kubeflow-metrics">Query Kubeflow Metrics<a href="#query-kubeflow-metrics" class="hash-link" aria-label="Direct link to Query Kubeflow Metrics" title="Direct link to Query Kubeflow Metrics">​</a></h3><p>Next lets navigate to Amazon Managed Grafana console and import Grafana dashboards which allows us to visualize metrics from Istio environment. Go to the <code>plus</code> sign on the left navigation bar and select <code>Import</code> as shown below:</p><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-3-420e87a81bcc833283ce52e1e6d4926a.jpg" width="1778" height="531" class="img_ev3q"></p><p>In the Import screen, type <code>7630 (Istio Workload Dashboard)</code> in <code>Import via grafana.com</code> textbox and click <code>Load. </code>Select the Prometheus data source in the drop down at the bottom and click on <code>Import</code>. Once complete, you will be able to see the Grafana dashboard showing metrics from the <code>Istio Workload Dashboard</code> through Prometheus data source as shown below:</p><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-4-104e34dab44eacd046137923ff15929d.jpg" width="3800" height="1798" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-sample-machine-learning-pipeline-in-kubeflow">Creating a sample Machine Learning pipeline in Kubeflow<a href="#creating-a-sample-machine-learning-pipeline-in-kubeflow" class="hash-link" aria-label="Direct link to Creating a sample Machine Learning pipeline in Kubeflow" title="Direct link to Creating a sample Machine Learning pipeline in Kubeflow">​</a></h3><p>Now that we have configured Amazon Managed Grafana with the Prometheus data source within our cluster, we can initiate a Machine Learning pipeline in Kubeflow, and be able to display metrics on the Grafana dashboards.</p><p>Before we create the notebook to use Kubeflow Pipelines SDK, we have to supply a token so that the notebook can authenticate with the Kubeflow Pipelines API. To do so, run the following command to create a Pod to mount a token volume:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> kubectl apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubeflow.org/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PodDefault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> access</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ml</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubeflow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">desc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Allow access to Kubeflow Pipelines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">access-ml-pipeline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> volume</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">projected</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">serviceAccountToken</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">expirationSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">audience</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipelines.kubeflow.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/secrets/kubeflow/pipelines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> volume</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KF_PIPELINES_SA_TOKEN_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/secrets/kubeflow/pipelines/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, access Kubeflow dashboard as described in the previous sections, via port-forwarding. Select <code>Notebooks</code>, and create a new CPU-based notebook, using the following configurations:</p><ul><li>name: <code>ml-training-notebook</code></li><li>docker image: <code>kubeflow-on-aws/notebook-servers/jupyter-pytorch:2.0.0-cpu-py310-ubuntu20.04-ec2-v1.0</code></li><li>Requested CPUs: <code>1</code></li><li>Requested memory in Gi: <code>5</code></li><li>Advanced Options → Configurations: <code>Allow access to Kubeflow Pipelines</code>  (This configuration is the token we have generated above)</li></ul><p>With all other configurations as defaults, you should be able to see the notebook generate successfully and show up on the Kubeflow dashboard.</p><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-5-fdac1c7e17f72a11cf464e5ca84c1304.jpg" width="2548" height="381" class="img_ev3q"></p><p>You can also verify that the notebook is created by verifying the Kubernetes resources being created:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kubeflow-user-example-com --field-selector</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">status.phase</span><span class="token operator" style="color:#393A34">==</span><span class="token plain">Running</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                               READY   STATUS     RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ml-pipeline-ui-artifact-5b7794c7b5-5hkqf           2/2     Running   0          100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ml-pipeline-visualizationserver-85c6d6cc9f-vs24x   2/2     Running   0          100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ml-training-notebook-0                             2/2     Running   0          11m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will be able to access the JupyterLab notebook by clicking CONNECT. This will open up a new JupyterLab window:</p><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-6-ede25e58ae6bce6228f7218acdbf4699.jpg" width="2553" height="842" class="img_ev3q"></p><p>We will run a simple pipeline training notebook that uses Kubeflow Pipelines, from an existing <a href="https://github.com/aws-samples/aws-deeplearning-labs" target="_blank" rel="noopener noreferrer">AWS Deep Learning sample repository</a>. This is a simple model training to predict the taxi fare of Chicago cabs, and demonstrates continuous training using a recursive loop. It triggers a Kubeflow pipeline to train the initial model and then gradually trains the model until evaluation metrics are good enough. Lets run the Kubeflow pipeline using the following steps on the console :</p><ul><li>Clone the following repo by selecting <code>Git -&gt; Clone a Repository</code> from the top navigation bar and paste <code>https://github.com/aws-samples/aws-deeplearning-labs</code> and press enter.</li><li>Open the following notebook from the directory view in the left pane: <code>aws-deeplearning-labs/workshop/pytorch-distributed-training/STEP2_simple_xgboost_training_pipeline.ipynb</code>.</li><li>Run all the cells of the model by selecting <code>Kernel -&gt; Restart Kernel and Run All Cells</code> from the top menu</li></ul><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-7-68da0bee12946efad7ce90c7a0a750a9.jpg" width="3448" height="1742" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="visualizing-machine-learning-pipeline-metrics-on-amazon-managed-grafana">Visualizing Machine Learning pipeline metrics on Amazon Managed Grafana<a href="#visualizing-machine-learning-pipeline-metrics-on-amazon-managed-grafana" class="hash-link" aria-label="Direct link to Visualizing Machine Learning pipeline metrics on Amazon Managed Grafana" title="Direct link to Visualizing Machine Learning pipeline metrics on Amazon Managed Grafana">​</a></h3><p>Using the Amazon Managed Grafana, we can show the resource utilization from our Machine Learning Pipelines with the same method we used to look above: using the <code>Istio Workload Dashboard</code> (7630). Select the following to monitor your resources for this particular ML pipeline:</p><ul><li>Datasource: <code>your prometheus workspace name</code></li><li>Namespace: <code>kubeflow-user-example-com</code></li><li>Workload: <code>ml-training-notebook</code></li></ul><p><img loading="lazy" alt="Mon-Kubeflow" src="/data-on-eks/assets/images/mon-kubeflow-8-92525975ca2682b286063def15d20c51.jpg" width="2499" height="1152" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alerting-kubeflow-workflows-with-amazon-managed-grafana">Alerting Kubeflow workflows with Amazon Managed Grafana<a href="#alerting-kubeflow-workflows-with-amazon-managed-grafana" class="hash-link" aria-label="Direct link to Alerting Kubeflow workflows with Amazon Managed Grafana" title="Direct link to Alerting Kubeflow workflows with Amazon Managed Grafana">​</a></h3><p>As we configure workflows with Kubeflow, alerting is a mechanism we can employ to alert on specific situations. By quickly identifying unintended changes in your workflow and notifying the same using alerts, you can take actions to minimize disruptions to your services. Amazon Managed Grafana supports multiple notification channels such as SNS, Slack, PagerDuty etc to which you can send alerts notifications. <a href="https://docs.aws.amazon.com/grafana/latest/userguide/alerts-overview.html" target="_blank" rel="noopener noreferrer">Alerts</a> page will show you more information on how to setup alerts in Amazon Managed Grafana. You learn about setting up alerts from Amazon Managed Grafana to <a href="https://slack.com/" target="_blank" rel="noopener noreferrer">Slack</a> from  our <a href="https://aws.amazon.com/blogs/mt/monitoring-hybrid-environments-using-amazon-managed-service-for-grafana/" target="_blank" rel="noopener noreferrer">Monitoring hybrid environments using Amazon Managed Grafana</a> blog. Also check our Blog on <a href="https://aws.amazon.com/blogs/mt/monitor-istio-on-eks-using-amazon-managed-prometheus-and-amazon-managed-grafana/" target="_blank" rel="noopener noreferrer">Monitor Istio on EKS using Amazon Managed Prometheus and Amazon Managed Grafana</a> which will show you on triggering Amazon Managed Grafana alerts to <a href="https://www.pagerduty.com/" target="_blank" rel="noopener noreferrer">PagerDuty</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="clean-up">Clean-up<a href="#clean-up" class="hash-link" aria-label="Direct link to Clean-up" title="Direct link to Clean-up">​</a></h2><p>Use the following commands to clean up the created AWS resources for this demonstration:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Clean up ADOT Collector and Prometheus.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f https://amazon-eks.s3.amazonaws.com/docs/addons-otel-permissions.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f ./otel-collector-prometheus.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf ./otel-collector-prometheus.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws eks delete-addon </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --addon-name adot </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-name </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws amp delete-workspace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --workspace-id </span><span class="token variable" style="color:#36acaa">$KFL_WORKSPACE_ID</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region </span><span class="token variable" style="color:#36acaa">$KFL_AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl delete iamserviceaccount </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name amp-iamproxy-ingest-role </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --namespace prometheus </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete namespace prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Cleaning up kubeflow installation components</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> delete-kubeflow </span><span class="token assign-left variable" style="color:#36acaa">INSTALLATION_OPTION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kustomize </span><span class="token assign-left variable" style="color:#36acaa">DEPLOYMENT_OPTION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vanilla</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf kubeflow-manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl delete iamserviceaccount </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name ebs-csi-controller-sa </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --namespace kube-system </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws eks delete-addon </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --addon-name aws-ebs-csi-driver </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-name </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Cleaning up Amazon EKS Cluster.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl delete cluster --region </span><span class="token variable" style="color:#36acaa">$AWS_REGION</span><span class="token plain"> --name </span><span class="token variable" style="color:#36acaa">$KFL_EKS_CLUSTER</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally navigate to Amazon Managed Grafana console to delete the created Grafana workspace.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>This post demonstrated the detailed steps on how you can setup Amazon EKS cluster with Kubeflow, Amazon Managed Service for Prometheus and Amazon Managed Grafana to monitor your Kubeflow machine learning workflows.  </p><p>It is also important to have a centralized incident management process to keep systems running smoothly. You can view more details on alerting in and various supported providers at <a href="https://docs.aws.amazon.com/grafana/latest/userguide/alert-notifications.html" target="_blank" rel="noopener noreferrer">alert notifications</a> for Amazon Managed Grafana. You can also check out previous blogs posts <a href="https://aws.amazon.com/blogs/mt/using-amazon-managed-service-for-prometheus-alert-manager-to-receive-alerts-with-pagerduty/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus Alert Manager to receive alerts with PagerDuty</a> and <a href="https://aws.amazon.com/blogs/mt/how-to-integrate-amazon-managed-service-for-prometheus-with-slack/" target="_blank" rel="noopener noreferrer">how to integrate Amazon Managed Service for Prometheus with Slack</a> to see how you can setup alerting with Amazon Managed Service for Prometheus.</p><p>For further reading on Kubeflow deployment and monitoring on Amazon EKS, check out <a href="https://aws.amazon.com/blogs/machine-learning/build-and-deploy-a-scalable-machine-learning-system-on-kubernetes-with-kubeflow-on-aws/" target="_blank" rel="noopener noreferrer">Build and deploy a scalable machine learning system on Kubernetes with Kubeflow on AWS</a> and <a href="https://awslabs.github.io/kubeflow-manifests/docs/deployment/add-ons/cloudwatch/guide/" target="_blank" rel="noopener noreferrer">CloudWatch add-on for Kubeflow.</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/blueprints/ai-ml/monitoring-kubeflow.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/data-on-eks/docs/blueprints/ai-ml/jupyterhub"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JupyterHub on EKS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/data-on-eks/docs/category/job-schedulers-on-eks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Job Schedulers on EKS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture" class="table-of-contents__link toc-highlight"><strong>Architecture</strong></a></li><li><a href="#solution-walkthrough" class="table-of-contents__link toc-highlight">Solution Walkthrough</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#create-an-eks-cluster" class="table-of-contents__link toc-highlight">Create an EKS Cluster</a></li><li><a href="#installing-amazon-elastic-block-store-ebs-container-storage-interface-driver" class="table-of-contents__link toc-highlight">Installing <strong>Amazon Elastic Block Store (EBS) Container Storage Interface Driver</strong></a></li><li><a href="#installing-kubeflow" class="table-of-contents__link toc-highlight">Installing Kubeflow</a></li><li><a href="#accessing-kubeflow-central-dashboard" class="table-of-contents__link toc-highlight">Accessing Kubeflow Central Dashboard</a></li><li><a href="#setup-amazon-managed-service-for-prometheus" class="table-of-contents__link toc-highlight">Setup Amazon Managed Service for Prometheus</a></li><li><a href="#setting-up-the-aws-distro-for-opentelemetry-adot-collector-to-ingest-metrics" class="table-of-contents__link toc-highlight">Setting up the AWS Distro for OpenTelemetry (ADOT) Collector to Ingest Metrics</a></li><li><a href="#amazon-managed-grafana-setup" class="table-of-contents__link toc-highlight">Amazon Managed Grafana Setup</a></li><li><a href="#query-kubeflow-metrics" class="table-of-contents__link toc-highlight">Query Kubeflow Metrics</a></li><li><a href="#creating-a-sample-machine-learning-pipeline-in-kubeflow" class="table-of-contents__link toc-highlight">Creating a sample Machine Learning pipeline in Kubeflow</a></li><li><a href="#visualizing-machine-learning-pipeline-metrics-on-amazon-managed-grafana" class="table-of-contents__link toc-highlight">Visualizing Machine Learning pipeline metrics on Amazon Managed Grafana</a></li><li><a href="#alerting-kubeflow-workflows-with-amazon-managed-grafana" class="table-of-contents__link toc-highlight">Alerting Kubeflow workflows with Amazon Managed Grafana</a></li></ul></li><li><a href="#clean-up" class="table-of-contents__link toc-highlight">Clean-up</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Get Started</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/data-on-eks/docs/introduction/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Get Involved</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS  <br> © 2023 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer></div>
<script src="/data-on-eks/assets/js/runtime~main.0a31b3b0.js"></script>
<script src="/data-on-eks/assets/js/main.32556954.js"></script>
</body>
</html>