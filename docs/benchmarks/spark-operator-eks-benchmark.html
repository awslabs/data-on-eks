<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-benchmarks/spark-operator-eks-benchmark" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>Kubeflow Spark Operator Benchmarks ðŸš€ | Data on EKS</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Kubeflow Spark Operator Benchmarks ðŸš€ | Data on EKS"><meta data-rh=true name=description content="This document serves as a comprehensive guide for conducting a scale test for the Kubeflow Spark Operator on Amazon EKS. The primary objective is to evaluate the performance, scalability, and stability of the Spark Operator under heavy workloads by submitting thousands of jobs and analyzing its behavior under stress."><meta data-rh=true property=og:description content="This document serves as a comprehensive guide for conducting a scale test for the Kubeflow Spark Operator on Amazon EKS. The primary objective is to evaluate the performance, scalability, and stability of the Spark Operator under heavy workloads by submitting thousands of jobs and analyzing its behavior under stress."><link data-rh=true rel=icon href=/data-on-eks/img/header-icon.png><link data-rh=true rel=canonical href=https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark><link data-rh=true rel=alternate href=https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark hreflang=en><link data-rh=true rel=alternate href=https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark","name":"Kubeflow Spark Operator Benchmarks","position":1}]}</script><link rel=stylesheet href=/data-on-eks/assets/css/styles.3153bbff.css><script src=/data-on-eks/assets/js/runtime~main.531fbb16.js defer></script><script src=/data-on-eks/assets/js/main.e6adddb2.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/data-on-eks/><div class=navbar__logo><img src=/data-on-eks/img/header-icon.png alt="DoEKS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/data-on-eks/img/header-icon.png alt="DoEKS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href=/data-on-eks/docs/blueprints/data-analytics>Blueprints</a><a class="navbar__item navbar__link" href=/data-on-eks/docs/bestpractices/intro>Best Practices</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/data-on-eks/docs/benchmarks/emr-on-eks>Benchmarks</a><a class="navbar__item navbar__link" href=/data-on-eks/docs/resources/intro>Resources</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/awslabs/data-on-eks target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class=navbar__search><span aria-label="expand searchbar" role=button class=search-icon tabindex=0></span><input id=search_input_react type=search placeholder=Loading... aria-label=Search class="navbar__search-input search-bar" disabled></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/data-on-eks/docs/benchmarks/emr-on-eks>EMR on EKS Benchmarks</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/data-on-eks/docs/category/spark-benchmarks>Spark Benchmarks</a><button aria-label="Expand sidebar category 'Spark Benchmarks'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current=page href=/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark>Kubeflow Spark Operator Benchmarks</a></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/data-on-eks/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Kubeflow Spark Operator Benchmarks</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kubeflow Spark Operator Benchmarks ðŸš€</h1></header>
<p>This document serves as a comprehensive guide for conducting a scale test for the Kubeflow Spark Operator on Amazon EKS. The primary objective is to evaluate the performance, scalability, and stability of the Spark Operator under heavy workloads by submitting thousands of jobs and analyzing its behavior under stress.</p>
<p>This guide provides a step-by-step approach to:</p>
<ul>
<li>Steps to <strong>configure the Spark Operator</strong> for high-scale job submissions.</li>
<li><strong>Infrastructure setup</strong> modifications for performance optimization.</li>
<li>Load testing execution details using <strong>Locust</strong>.</li>
<li><strong>Grafana dashboard</strong> for monitoring Spark Operator metrics and Kubernetes metrics</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=-why-we-need-the-benchmark-tests>âœ¨ Why We Need the Benchmark Tests<a href=#-why-we-need-the-benchmark-tests class=hash-link aria-label="Direct link to âœ¨ Why We Need the Benchmark Tests" title="Direct link to âœ¨ Why We Need the Benchmark Tests">â€‹</a></h3>
<p>Benchmark testing is a critical step in assessing the efficiency and reliability of the Spark Operator when handling large-scale job submissions. These tests provide valuable insights into:</p>
<ul>
<li><strong>Identifying performance bottlenecks:</strong>  Pinpointing areas where the system struggles under heavy loads.</li>
<li><strong>Ensuring optimized resource utilization:</strong> Ensuring that CPU, memory, and other resources are used efficiently.</li>
<li><strong>Evaluating system stability under heavy workloads:</strong> Testing the systemâ€™s ability to maintain performance and reliability under extreme conditions.</li>
</ul>
<p>By conducting these tests, you can ensure that the Spark Operator is capable of handling real-world, high-demand scenarios effectively.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=prerequisites>Prerequisites<a href=#prerequisites class=hash-link aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">â€‹</a></h3>
<ul>
<li>Before running the benchmark tests, ensure you have deployed the <strong>Spark Operator</strong> EKS cluster by following the instructions <a href=https://awslabs.github.io/data-on-eks/docs/blueprints/data-analytics/spark-operator-yunikorn#deploy target=_blank rel="noopener noreferrer">here</a>.</li>
<li>Access to the necessary AWS resources and permissions to modify EKS configurations.</li>
<li>Familiarity with <strong>Terraform</strong>, <strong>Kubernetes</strong>, and <strong>Locust</strong> for load testing.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=updates-to-the-cluster>Updates to the Cluster<a href=#updates-to-the-cluster class=hash-link aria-label="Direct link to Updates to the Cluster" title="Direct link to Updates to the Cluster">â€‹</a></h3>
<p>To prepare the cluster for benchmark testing, apply the following modifications:</p>
<p><strong>Step 1: Update Spark Operator Helm Configuration</strong></p>
<p>Uncomment the specified Spark Operator Helm values in the file <a href=https://github.com/awslabs/data-on-eks/blob/main/analytics/terraform/spark-k8s-operator/addons.tf target=_blank rel="noopener noreferrer">analytics/terraform/spark-k8s-operator/addons.tf</a> (from the <code>-- Start</code> to <code>-- End</code> section). Then, run terraform apply to apply the changes.</p>
<p>These updates ensure that:</p>
<ul>
<li>The Spark Operator and webhook pods are deployed on a dedicated <code>c5.9xlarge</code> instance using Karpenter.</li>
<li>The instance provides <code>36 vCPUs</code> to handle <code>6000</code> application submissions.</li>
<li>High CPU and memory resources are allocated for both the Controller pod and Webhook pods.</li>
</ul>
<p>Hereâ€™s the updated configuration:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">enable_spark_operator = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  spark_operator_helm_config = </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    version = "2.1.0"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    timeout = "120"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    values = </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      &lt;&lt;</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">EOT</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>controller</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>replicas</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic># -- Reconcile concurrency, higher values might increase memory usage.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic># -- Increased from 10 to 20 to leverage more cores from the instance</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>workers</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>20</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic># -- Change this to True when YuniKorn is deployed</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>batchScheduler</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>enable</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic># default: "yunikorn"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>#  -- Start: Uncomment this section in the code for Spark Operator scale test</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic># -- Spark Operator is CPU bound so add more CPU or use compute optimized instance for handling large number of job submissions</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>nodeSelector</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>NodeGroupType</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> spark</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">operator</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">benchmark</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>resources</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>requests</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token key atrule" style=color:#00a4db>cpu</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 33000m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token key atrule" style=color:#00a4db>memory</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 50Gi</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>webhook</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>nodeSelector</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>NodeGroupType</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> spark</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">operator</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">benchmark</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>resources</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>requests</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token key atrule" style=color:#00a4db>cpu</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 1000m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token key atrule" style=color:#00a4db>memory</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 10Gi</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>#  -- End: Uncomment this section in the code for Spark Operator scale test</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>spark</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>jobNamespaces</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> spark</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">team</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">a</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> spark</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">team</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">b</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> spark</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">team</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">c</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>serviceAccount</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>create</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>rbac</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>create</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>prometheus</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>metrics</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>enable</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8080</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>portName</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> metrics</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>endpoint</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> /metrics</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>prefix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>""</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>podMonitor</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>create</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>labels</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>jobLabel</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> spark</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">operator</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">podmonitor</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>podMetricsEndpoint</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token key atrule" style=color:#00a4db>scheme</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token key atrule" style=color:#00a4db>interval</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 5s</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      EOT</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p><strong>Step 2: Prometheus Best practices for Large scale clusters</strong></p>
<ul>
<li>To efficiently monitor 32,000+ pods across 200 nodes, Prometheus should run on a dedicated node with increased CPU and memory allocation. Ensure Prometheus is deployed on core node groups using NodeSelectors in the Prometheus Helm chart. This prevents interference from workload pods.</li>
<li>At scale, <strong>Prometheus</strong> can consume significant CPU and memory, so running it on dedicated infrastructure ensures it doesnâ€™t compete with your apps. Itâ€™s common to dedicate a node or node pool solely to monitoring components (Prometheus, Grafana, etc.) using node selectors or taints.</li>
<li>Prometheus is memory-intensive and, when monitoring hundreds or thousands of pods, will also demand substantial CPUâ€‹</li>
<li>Allocating dedicated resources (and even using Kubernetes priority classes or QoS to favor Prometheus) helps keep your monitoring reliable under stress.</li>
<li>Please note that full observability stack (metrics, logs, tracing) might consume roughly one-third of your infrastructure resources at scaleâ€‹, so plan capacity accordingly.</li>
<li>Allocate ample memory and CPU from the start, and prefer requests without strict low limits for Prometheus. For example, if you estimate Prometheus needs <code>~8Â GB</code>, donâ€™t cap it at <code>4Â GB</code>. Itâ€™s better to reserve an entire node or a large chunk of one for Prometheus.</li>
</ul>
<p><strong>Step 3: Configure VPC CNI for High Pod Density:</strong></p>
<p>Modify <a href=https://github.com/awslabs/data-on-eks/blob/main/analytics/terraform/spark-k8s-operator/eks.tf target=_blank rel="noopener noreferrer">analytics/terraform/spark-k8s-operator/eks.tf</a> to enable <code>prefix delegation</code> in the <code>vpc-cni</code> addon. This increases the pod capacity per node from <code>110 to 200</code>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">cluster_addons = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  vpc-cni = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    configuration_values = jsonencode({</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      env = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ENABLE_PREFIX_DELEGATION = "true"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        WARM_PREFIX_TARGET       = "1"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    })</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Important Note:</strong> After making these changes, run <code>terraform apply</code> to update the VPC CNI configuration.</p>
<p><strong>Step 4: Create a Dedicated Node Group for Spark Load Testing</strong></p>
<p>We have created a dedicated Managed node group called <strong>spark_operator_bench</strong> for placing the Spark Jobs pods. Configured a <code>200-node</code> managed node group with <code>m6a.4xlarge</code> instances for Spark load test pods. The user-data has been modified to allow up to <code>220 pods per node</code>.</p>
<p><strong>Note:</strong> This step is informational only, and no changes need to be applied manually.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">spark_operator_bench = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  name        = "spark_operator_bench"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  description = "Managed node group for Spark Operator Benchmarks with EBS using x86 or ARM"</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  min_size     = 0</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  max_size     = 200</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  desired_size = 0</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  cloudinit_pre_nodeadm = [</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      content_type = "application/node.eks.aws"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      content      = &lt;&lt;-EOT</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ---</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        apiVersion: node.eks.aws/v1alpha1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        kind: NodeConfig</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        spec:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          kubelet:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            config:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">              maxPods: 220</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      EOT</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">...</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Step 5: Manually Update Node Group Min Size to 200</strong></p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>caution</div><div class=admonitionContent_BuS1><p>Running 200 nodes can incur significant costs. If you plan to run this test independently, carefully estimate the expenses in advance to ensure budget feasibility.</div></div>
<p>Initially, set <code>min_size = 0</code>. Before starting the load test, update <code>min_size</code> and <code>desired_size</code> to <code>200</code> in the AWS console. This pre-creates all nodes required for the load test, ensuring all DaemonSets are running.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=load-test-configuration-and-execution>Load Test Configuration and Execution<a href=#load-test-configuration-and-execution class=hash-link aria-label="Direct link to Load Test Configuration and Execution" title="Direct link to Load Test Configuration and Execution">â€‹</a></h3>
<p>To simulate high-scale concurrent job submissions, we developed <strong>Locust</strong> scripts that dynamically create Spark Operator templates and submit jobs concurrently by simulating multiple users.</p>
<p><strong>Step 1: Set Up a Python Virtual Environment</strong>
On your local machine (Mac or desktop), create a Python virtual environment and install the required dependencies:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">cd analytics/terraform/spark-k8s-operator/examples/benchmark/spark-operator-benchmark-kit</span><br></span><span class=token-line style=color:#393A34><span class="token plain">python3.12 -m venv venv</span><br></span><span class=token-line style=color:#393A34><span class="token plain">source venv/bin/activate</span><br></span><span class=token-line style=color:#393A34><span class="token plain">pip install -r requirements.txt</span><br></span></code></pre></div></div>
<p><strong>Step 2: Run the Load Test</strong>
Execute the following command to start the load test:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">locust </span><span class="token parameter variable" style=color:#36acaa>--headless</span><span class="token plain"> --only-summary </span><span class="token parameter variable" style=color:#36acaa>-u</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>3</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>-r</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--job-limit-per-user </span><span class="token number" style=color:#36acaa>2000</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--jobs-per-min </span><span class="token number" style=color:#36acaa>1000</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--spark-namespaces spark-team-a,spark-team-b,spark-team-c</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li>
<p>Starts a test with <strong>3 concurrent users</strong>.</p>
</li>
<li>
<p>Each user submits <strong>2000 jobs</strong> at a rate of <strong>1000 jobs per minute</strong>.</p>
</li>
<li>
<p>Total of <strong>6000 jobs</strong> are submitted by this command. Each Spark job consists of <strong>6 pods</strong> (1 Driver and 5 executor pods)</p>
</li>
<li>
<p>Generates <strong>36,000 pods</strong> across <strong>200 nodes</strong> using <strong>3 namespaces</strong>.</p>
</li>
<li>
<p>Locust script uses the Spark job template located at: <code>analytics/terraform/spark-k8s-operator/examples/benchmark/spark-operator-benchmark-kit/spark-app-with-webhook.yaml</code>.</p>
</li>
<li>
<p>Spark job uses a simple <code>spark-pi-sleep.jar</code> that sleeps for a specified duration. The testing image is available at: <code>public.ecr.aws/data-on-eks/spark:pi-sleep-v0.0.2</code></p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=results-verification>Results Verification<a href=#results-verification class=hash-link aria-label="Direct link to Results Verification" title="Direct link to Results Verification">â€‹</a></h3>
<p>The load test runs for approximately 1 hour. During this time, you can monitor the Spark Operator metrics, cluster performance and resource utilization using Grafana. Follow the steps below to access the monitoring dashboard:</p>
<p><strong>Step1: Port-forward Grafana Service</strong>
Run the following command to create a local port-forward, making Grafana accessible from your local machine:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">kubectl port-forward svc/kube-prometheus-stack-grafana </span><span class="token number" style=color:#36acaa>3000</span><span class="token plain">:80 </span><span class="token parameter variable" style=color:#36acaa>-n</span><span class="token plain"> kube-prometheus-stack</span><br></span></code></pre></div></div>
<p>This maps port 3000 on your local system to Grafana's service inside the cluster.</p>
<p><strong>Step2: Access Grafana</strong>
To log into Grafana, retrieve the secret name storing the admin credentials:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">terraform output grafana_secret_name</span><br></span></code></pre></div></div>
<p>Then, use the retrieved secret name to fetch credentials from AWS Secrets Manager:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">aws secretsmanager get-secret-value --secret-id </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">grafana_secret_name_output</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>--region</span><span class="token plain"> </span><span class="token variable" style=color:#36acaa>$AWS_REGION</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>--query</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"SecretString"</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>--output</span><span class="token plain"> text</span><br></span></code></pre></div></div>
<p><strong>Step 3: Access Grafana Dashboard</strong></p>
<ol>
<li>Open a web browser and navigate to <a href=http://localhost:3000 target=_blank rel="noopener noreferrer">http://localhost:3000</a>.</li>
<li>Enter username as <code>admin</code> and password as the retrieved password from the previous command.</li>
<li>Navigate to the Spark Operator Load Test Dashboard to visualize:</li>
</ol>
<ul>
<li>The number of Spark jobs submitted.</li>
<li>Cluster-wide CPU and memory consumption.</li>
<li>Pod scaling behavior and resource allocation.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=summary-of-results>Summary of Results<a href=#summary-of-results class=hash-link aria-label="Direct link to Summary of Results" title="Direct link to Summary of Results">â€‹</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>For a detailed analysis, refer to the <a href=https://www.kubeflow.org/docs/components/spark-operator/overview/ target=_blank rel="noopener noreferrer">Kubeflow Spark Operator Website</a></div></div>
<p><strong>CPU Utilization:</strong></p>
<ul>
<li>The Spark Operator controller pod is CPU-bound, utilizing all 36 cores during peak processing.</li>
<li>CPU constraints limit job processing speed, making compute power a key factor for scalability.</li>
</ul>
<p><strong>Memory Usage:</strong></p>
<ul>
<li>Memory consumption remains stable, regardless of the number of applications processed.</li>
<li>This indicates that memory is not a bottleneck, and increasing RAM would not improve performance.</li>
</ul>
<p><strong>Job Processing Rate:</strong></p>
<ul>
<li>The Spark Operator processes applications at ~130 apps per minute.</li>
<li>The processing rate is capped by CPU limitations, preventing further scaling without additional compute resources.</li>
</ul>
<p><strong>Time to Process Jobs:</strong></p>
<ul>
<li>~15 minutes to process 2,000 applications.</li>
<li>~30 minutes to process 4,000 applications.</li>
<li>These numbers align with the observed 130 apps per minute processing rate.</li>
</ul>
<p><strong>Work Queue Duration Metric Reliability:</strong></p>
<ul>
<li>The default work queue duration metric becomes unreliable once it exceeds 16 minutes.</li>
<li>Under high concurrency, this metric fails to provide accurate insights into queue processing times.</li>
</ul>
<p><strong>API Server Performance Impact:</strong></p>
<ul>
<li>Kubernetes API request duration increases significantly under high workload conditions.</li>
<li>This is caused by Spark querying executor pods frequently, not a limitation of the Spark Operator itself.</li>
<li>The increased API server load affects job submission latency and monitoring performance across the cluster.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=cleanup>Cleanup<a href=#cleanup class=hash-link aria-label="Direct link to Cleanup" title="Direct link to Cleanup">â€‹</a></h2>
<p><strong>Step 1: Scale Down Node Group</strong></p>
<p>To avoid unnecessary costs, first scale down the <strong>spark_operator_bench</strong> node group by setting its minimum and desired node count to zero:</p>
<ol>
<li>Log in to the AWS Console.</li>
<li>Navigate to the EKS section.</li>
<li>Locate and select the <strong>spark_operator_bench</strong> node group.</li>
<li>Edit the node group and update the Min Size and Desired Size to 0.</li>
<li>Save the changes to scale down the nodes.</li>
</ol>
<p><strong>Step 2: Destroy the Cluster</strong>
Once the nodes have been scaled down, you can proceed with cluster teardown using the following script:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style=color:#36acaa>${DOEKS_HOME}</span><span class="token plain">/analytics/terraform/spark-k8s-operator </span><span class="token operator" style=color:#393A34>&&</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>chmod</span><span class="token plain"> +x cleanup.sh</span><br></span><span class=token-line style=color:#393A34><span class="token plain">./cleanup.sh</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/awslabs/data-on-eks/blob/main/website/docs/benchmarks/spark-operator-eks-benchmark.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/data-on-eks/docs/benchmarks/spark-operator-benchmark/graviton-r-data><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Gravtion R-series Results</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#-why-we-need-the-benchmark-tests class="table-of-contents__link toc-highlight">âœ¨ Why We Need the Benchmark Tests</a><li><a href=#prerequisites class="table-of-contents__link toc-highlight">Prerequisites</a><li><a href=#updates-to-the-cluster class="table-of-contents__link toc-highlight">Updates to the Cluster</a><li><a href=#load-test-configuration-and-execution class="table-of-contents__link toc-highlight">Load Test Configuration and Execution</a><li><a href=#results-verification class="table-of-contents__link toc-highlight">Results Verification</a><li><a href=#summary-of-results class="table-of-contents__link toc-highlight">Summary of Results</a><li><a href=#cleanup class="table-of-contents__link toc-highlight">Cleanup</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Get Started</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/data-on-eks/docs/introduction/intro>Docs</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Get Involved</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/awslabs/data-on-eks target=_blank rel="noopener noreferrer" class=footer__link-item>Github<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Built with â¤ï¸ at AWS  <br> Â© 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "7fbc7ab02fae4767b1af2588eba0cdf2"}'></script></div>