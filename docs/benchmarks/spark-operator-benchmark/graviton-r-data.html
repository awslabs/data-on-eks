<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-benchmarks/spark-operator-benchmark/graviton-r-data" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">TPCDS Spark Benchmark Results for Graviton R6g, R7g, and R8g | Data on EKS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-benchmark/graviton-r-data"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TPCDS Spark Benchmark Results for Graviton R6g, R7g, and R8g | Data on EKS"><meta data-rh="true" name="description" content="This page has the results of our benchmarking tests on R-series Graviton instances, demonstrating up to a 1.6x faster runtime on newer generation instances."><meta data-rh="true" property="og:description" content="This page has the results of our benchmarking tests on R-series Graviton instances, demonstrating up to a 1.6x faster runtime on newer generation instances."><link data-rh="true" rel="icon" href="/data-on-eks/img/header-icon.png"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-benchmark/graviton-r-data"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-benchmark/graviton-r-data" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/benchmarks/spark-operator-benchmark/graviton-r-data" hreflang="x-default"><link rel="stylesheet" href="/data-on-eks/assets/css/styles.74de95c8.css">
<script src="/data-on-eks/assets/js/runtime~main.cf47b72b.js" defer="defer"></script>
<script src="/data-on-eks/assets/js/main.80a28938.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/data-on-eks/"><div class="navbar__logo"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/data-on-eks/docs/introduction/intro">Introduction</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/gen-ai">Gen AI</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/blueprints/amazon-emr-on-eks">Blueprints</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/bestpractices/intro">Best Practices</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/data-on-eks/docs/benchmarks/emr-on-eks">Benchmarks</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/resources/intro">Resources</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/data-on-eks/docs/benchmarks/emr-on-eks">EMR on EKS Benchmarks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/data-on-eks/docs/category/spark-benchmarks">Spark Benchmarks</a><button aria-label="Collapse sidebar category &#x27;Spark Benchmarks&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/benchmarks/spark-operator-benchmark/spark-operator-eks-benchmark">Introduction to Spark Benchmarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/benchmarks/spark-operator-benchmark/data-generation">Data Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/benchmarks/spark-operator-benchmark/running-the-benchmark">Running the Benchmarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/data-on-eks/docs/benchmarks/spark-operator-benchmark/graviton-r-data">Gravtion R-series Results</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark">Kubeflow Spark Operator Benchmarks</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/data-on-eks/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/data-on-eks/docs/category/spark-benchmarks"><span itemprop="name">Spark Benchmarks</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Gravtion R-series Results</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>TPCDS Spark Benchmark Results for Graviton R6g, R7g, and R8g</h1></header>
<p>This page has the results of our benchmarking tests on R-series Graviton instances, demonstrating up to a 1.6x faster runtime on newer generation instances.</p>
<p>These benchmarks were executed using the steps defined in the <a href="/data-on-eks/docs/benchmarks/spark-operator-benchmark/running-the-benchmark">Running the Benchmark</a> section across 1TB of data. We used the same EKS cluster, the same data set, the same number of nodes, and the same addons and configuration for all of these tests. We simply changed the instance types that were used for each run.
The full configuration details are below:</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> To view the Managed Node Group configuration, Click to toggle content!</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    spark_benchmark_ebs = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name        = &quot;spark_benchmark_ebs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description = &quot;Managed node group for Spark Benchmarks with EBS using x86 or ARM&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Filtering only Secondary CIDR private subnets starting with &quot;100.&quot;. Subnet IDs where the nodes/node groups will be provisioned</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subnet_ids = [element(compact([for subnet_id, cidr_block in zipmap(module.vpc.private_subnets, module.vpc.private_subnets_cidr_blocks) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        substr(cidr_block, 0, 4) == &quot;100.&quot; ? subnet_id : null]), 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Change ami_type= AL2023_x86_64_STANDARD for x86 instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ami_type = &quot;AL2023_ARM_64_STANDARD&quot; # arm64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Node group will be created with zero instances when you deploy the blueprint.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # You can change the min_size and desired_size to 6 instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # desired_size might not be applied through terrafrom once the node group is created so this needs to be adjusted in AWS Console.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      min_size     = 0 # Change min and desired to 6 for running benchmarks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max_size     = 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      desired_size = 0 # Change min and desired to 6 for running benchmarks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # This storage is used as a shuffle for non NVMe SSD instances. e.g., r8g instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      block_device_mappings = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xvda = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          device_name = &quot;/dev/xvda&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ebs = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            volume_size           = 300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            volume_type           = &quot;gp3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            iops                  = 3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            encrypted             = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delete_on_termination = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Change the instance type as you desire and match with ami_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      instance_types = [&quot;r8g.12xlarge&quot;] # Change Instance type to run the benchmark with various instance types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NodeGroupType = &quot;spark_benchmark_ebs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Name          = &quot;spark_benchmark_ebs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NodeGroupType = &quot;spark_benchmark_ebs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> To view the Spark Application configuration, Click to toggle content!</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sparkoperator.k8s.io/v1beta2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SparkApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tpcds</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">benchmark</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1tb</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ebs </span><span class="token comment" style="color:#999988;font-style:italic"># Change for each test with instancetype etc,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spark</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">team</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Temporarily commented out until the YuniKorn issue is resolved; falls back to the default Kubernetes scheduler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># batchScheduler: yunikorn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># batchSchedulerOptions:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#   queue: root.default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Scala</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> public.ecr.aws/data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">on</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">eks/spark3.5.3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scala2.12</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">java17</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tpcds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sparkVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 3.5.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mainClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.amazonaws.eks.tpcds.BenchmarkSQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mainApplicationFile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">///opt/spark/examples/jars/eks</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">spark</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">benchmark</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">assembly</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.0.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">arguments</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># TPC-DS data location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s3a://&lt;S3_BUCKET&gt;/TPCDS-TEST-1TB&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># results location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s3a://&lt;S3_BUCKET&gt;/TPCDS-TEST-1T-RESULT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Path to kit in the docker image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/tpcds-kit/tools&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Data Format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;parquet&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Scale factor (in GB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1000&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># changed from 3000 to 100gb for demo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Number of iterations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Optimize queries with hive tables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Filter queries, will run all if empty - &quot;q98-v2.4,q99-v2.4,ss_max-v2.4,q95-v2.4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Logging set to WARN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sparkConf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Expose Spark metrics for Prometheus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.ui.prometheus.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.executor.processTreeMetrics.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.metrics.conf.*.sink.prometheusServlet.class&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;org.apache.spark.metrics.sink.PrometheusServlet&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.metrics.conf.driver.sink.prometheusServlet.path&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/metrics/driver/prometheus/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.metrics.conf.executor.sink.prometheusServlet.path&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/metrics/executors/prometheus/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Spark Event logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.eventLog.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.eventLog.dir&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s3a://&lt;S3_BUCKET&gt;/spark-event-logs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.eventLog.rolling.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.eventLog.rolling.maxFileSize&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;64m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.network.timeout&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2000s&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.executor.heartbeatInterval&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;300s&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># AQE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.sql.adaptive.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.sql.adaptive.localShuffleReader.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.sql.adaptive.coalescePartitions.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.sql.adaptive.skewJoin.enabled&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.kubernetes.executor.podNamePrefix&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;benchmark-exec-ebs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># S3 Optimizations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;spark.hadoop.fs.s3a.aws.credentials.provider&quot;: &quot;com.amazonaws.auth.WebIdentityTokenCredentialsProvider&quot; # This is using AWS SDK V1 in maintenance mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.aws.credentials.provider.mapping&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;com.amazonaws.auth.WebIdentityTokenCredentialsProvider=software.amazon.awssdk.auth.credentials.WebIdentityTokenFileCredentialsProvider&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.aws.credentials.provider&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;software.amazon.awssdk.auth.credentials.WebIdentityTokenFileCredentialsProvider&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># AWS SDK V2 https://hadoop.apache.org/docs/stable/hadoop-aws/tools/hadoop-aws/aws_sdk_upgrade.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3.impl&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;org.apache.hadoop.fs.s3a.S3AFileSystem&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.fast.upload&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.path.style.access&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.fast.upload.buffer&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;disk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.buffer.dir&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/tmp/s3a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.multipart.size&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;128M&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Good for large files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.multipart.threshold&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;256M&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.threads.max&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;50&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.connection.maximum&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;200&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.mapreduce.fileoutputcommitter.algorithm.version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.executor.defaultJavaOptions&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-verbose:gc -XX:+UseParallelGC -XX:InitiatingHeapOccupancyPercent=70&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;spark.hadoop.fs.s3a.readahead.range&quot;: &quot;256K&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># -----------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># This block is very critical when you get errors like</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     Exception in thread \&quot;main\&quot; io.fabric8.kubernetes.client.KubernetesClientException: An error has occurred</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     Caused by: java.net.SocketTimeoutException: timeout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># spark.kubernetes.local.dirs.tmpfs: &quot;true&quot; # More details here https://spark.apache.org/docs/latest/running-on-kubernetes.html#using-ram-for-local-storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spark.kubernetes.submission.connectionTimeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;120000&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># milliseconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spark.kubernetes.submission.requestTimeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;120000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spark.kubernetes.driver.connectionTimeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;120000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spark.kubernetes.driver.requestTimeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;120000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># spark.kubernetes.allocation.batch.size: &quot;20&quot; # default 5 but adjust according to your cluster size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># -----------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># S3 Optimizations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.multipart.size&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;67108864&quot;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># 64 MB part size for S3 uploads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.threads.max&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;40&quot;</span><span class="token plain">                     </span><span class="token comment" style="color:#999988;font-style:italic"># Limit S3 threads for optimized throughput</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.connection.maximum&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic"># Set max connections for S3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Data writing and shuffle tuning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.shuffle.file.buffer&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1m&quot;</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic"># Increase shuffle buffer for better disk I/O</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.reducer.maxSizeInFlight&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;48m&quot;</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic"># Increase reducer buffer size in-flight data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Tuning multipart upload threshold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.multipart.purge&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># Automatically clear failed multipart uploads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;spark.hadoop.fs.s3a.multipart.threshold&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;134217728&quot;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 128 MB threshold to start multi-part upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cores</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20g&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memoryOverhead</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;6g&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">serviceAccount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spark</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">team</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">runAsUser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">185</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JAVA_HOME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/java/openjdk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">NodeGroupType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spark_benchmark_ebs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cores</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20g&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memoryOverhead</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;6g&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 8 executors per node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">instances</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">36</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 6 pods per node; 6 nodes with EKS Managed Node group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">serviceAccount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spark</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">team</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">runAsUser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">185</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JAVA_HOME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/java/openjdk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">NodeGroupType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spark_benchmark_ebs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> To view the Dockerfile for the Spark container image, Click to toggle content!</summary><div><div class="collapsibleContent_i85q"><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Use the official Spark base image with Java 17 and Python 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM apache/spark:3.5.3-scala2.12-java17-python3-ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Arguments for version control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG HADOOP_VERSION=3.4.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG AWS_SDK_VERSION=2.29.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG SPARK_UID=185</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set environment variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV SPARK_HOME=/opt/spark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set up as root to install dependencies and tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install necessary build tools and specific sbt version 0.13.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apt-get update &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get install -y \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gcc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        make \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        flex \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bison \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        git \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        openjdk-17-jdk \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wget \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        curl &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Install sbt 0.13.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://github.com/sbt/sbt/releases/download/v0.13.18/sbt-0.13.18.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tar -xzf sbt-0.13.18.tgz -C /usr/local &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ln -s /usr/local/sbt/bin/sbt /usr/local/bin/sbt &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Cleanup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm sbt-0.13.18.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get clean &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clone and compile TPC-DS toolkit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /opt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN git clone https://github.com/databricks/tpcds-kit.git &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd tpcds-kit/tools &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    make OS=LINUX &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chmod +x dsdgen dsqgen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clone the SQL perf library and related files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Change the branch from delta to tpcds-v2.13 for latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN git clone -b delta https://github.com/aws-samples/emr-on-eks-benchmark.git /tmp/emr-on-eks-benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build the Databricks SQL perf library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN cd /tmp/emr-on-eks-benchmark/spark-sql-perf &amp;&amp; sbt +package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use the compiled Databricks SQL perf library to build benchmark utility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN cd /tmp/emr-on-eks-benchmark/ &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mkdir -p /tmp/emr-on-eks-benchmark/benchmark/libs &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cp /tmp/emr-on-eks-benchmark/spark-sql-perf/target/scala-2.12/*.jar /tmp/emr-on-eks-benchmark/benchmark/libs &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd /tmp/emr-on-eks-benchmark/benchmark &amp;&amp; sbt assembly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove any old Hadoop libraries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -f ${SPARK_HOME}/jars/hadoop-client-* &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -f ${SPARK_HOME}/jars/hadoop-yarn-server-web-proxy-*.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add Hadoop AWS connector and AWS SDK for S3A support, along with hadoop-common dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TODO: hadoop-common, hadoop-yarn-server-web-proxy might not be required. Remove these and test it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN cd ${SPARK_HOME}/jars &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-aws/${HADOOP_VERSION}/hadoop-aws-${HADOOP_VERSION}.jar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-client-api/${HADOOP_VERSION}/hadoop-client-api-${HADOOP_VERSION}.jar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-client-runtime/${HADOOP_VERSION}/hadoop-client-runtime-${HADOOP_VERSION}.jar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-common/${HADOOP_VERSION}/hadoop-common-${HADOOP_VERSION}.jar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-yarn-server-web-proxy/${HADOOP_VERSION}/hadoop-yarn-server-web-proxy-${HADOOP_VERSION}.jar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wget https://repo1.maven.org/maven2/software/amazon/awssdk/bundle/${AWS_SDK_VERSION}/bundle-${AWS_SDK_VERSION}.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create directory for TPC-DS data and set permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir -p /opt/tpcds-data &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chown -R ${SPARK_UID}:${SPARK_UID} /opt/tpcds-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the built JARs to Spark&#x27;s jars directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir -p ${SPARK_HOME}/examples/jars/ &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cp /tmp/emr-on-eks-benchmark/benchmark/target/scala-2.12/*jar ${SPARK_HOME}/examples/jars/ &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chown -R ${SPARK_UID}:${SPARK_UID} ${SPARK_HOME}/examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set working directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR ${SPARK_HOME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Switch to non-root user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER ${SPARK_UID}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="results">Results<a href="#results" class="hash-link" aria-label="Direct link to Results" title="Direct link to Results"></a></h2>
<p>When reviewing the results for the TPCDS benchmark we are interested in the time it takes for the Spark SQL queries to complete, the faster those queries complete the better.
The graph below shows the cumulative runtime in seconds for all of the queries for each instance type we tested:</p>
<p><a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/benchmarks/spark-operator-benchmark/img/r-series-total-runtime.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="Total runtimes for the benchmarks per instance type" src="/data-on-eks/assets/images/r-series-total-runtime-8370f76744d83b5982bc9dc55fb8c834.png" width="3212" height="2374" class="img_ev3q"></a></p>
<p>We can similarly display the time for each query per instance, you can see the improvements in runtime for the newer generations.:</p>
<p><a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/benchmarks/spark-operator-benchmark/img/r-series-per-query.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="Total runtimes for the benchmarks per instance type" src="/data-on-eks/assets/images/r-series-per-query-36ce6b5f228dca6b98ec252bed968045.png" width="7612" height="3946" class="img_ev3q"></a></p>
<p>In the table below we have taken the Median times from the output for each instance type from a benchmark with 3 iterations of the queries and calculated the performance gained. You can view the <a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/benchmarks/spark-operator-benchmark/raw_data" target="_blank" rel="noopener noreferrer">raw output data in the <code>raw_data</code> folder here</a>.</p>
<p>To calculate the performance increase we are calculating a ratio of the query times. For example, to determine how much faster the r8g instances were compared to the r6g instances:</p>
<ul>
<li>Find the times corresponding to each query, using <code>q20-v2.4</code> as an example the r6g.12xlarge took <code>2.81s</code> and the r8g.12xlarge took <code>1.69s</code>.</li>
<li>We then divide r5g.12xlarge/r8g.12xlarge, for q20-v2.4 that&#x27;s <code>2.81s/1.69s = 1.66</code>. So for this query the r8g.12xlarge was able to complete the queries 1.66 times faster (or a ~66% percent improvement)</li>
</ul>
<p>The data has been sorted by the last column, showing the performance increase r8g.12xlarge has over the r6g.12xlarge.</p>
<div class="benchmark-results"><table><thead><tr><th style="text-align:left">Query</th><th style="text-align:left">r6g.12xlarge</th><th style="text-align:left">r7g.12xlarge</th><th style="text-align:left">r8g.12xlarge</th><th style="text-align:left"></th><th style="text-align:left">r7g times faster than r6g</th><th style="text-align:left">r8g times faster than r7g</th><th style="text-align:left">r8g times faster than r6g</th></tr></thead><tbody><tr><td style="text-align:left">q20-v2.4</td><td style="text-align:left">2.81</td><td style="text-align:left">1.94</td><td style="text-align:left">1.69</td><td style="text-align:left"></td><td style="text-align:left">1.45</td><td style="text-align:left">1.14</td><td style="text-align:left">1.66</td></tr><tr><td style="text-align:left">q39b-v2.4</td><td style="text-align:left">5.75</td><td style="text-align:left">4.26</td><td style="text-align:left">3.56</td><td style="text-align:left"></td><td style="text-align:left">1.35</td><td style="text-align:left">1.20</td><td style="text-align:left">1.61</td></tr><tr><td style="text-align:left">q45-v2.4</td><td style="text-align:left">7.66</td><td style="text-align:left">5.69</td><td style="text-align:left">4.92</td><td style="text-align:left"></td><td style="text-align:left">1.35</td><td style="text-align:left">1.15</td><td style="text-align:left">1.56</td></tr><tr><td style="text-align:left">q8-v2.4</td><td style="text-align:left">6.77</td><td style="text-align:left">5.19</td><td style="text-align:left">4.37</td><td style="text-align:left"></td><td style="text-align:left">1.31</td><td style="text-align:left">1.19</td><td style="text-align:left">1.55</td></tr><tr><td style="text-align:left">q73-v2.4</td><td style="text-align:left">5.08</td><td style="text-align:left">3.96</td><td style="text-align:left">3.31</td><td style="text-align:left"></td><td style="text-align:left">1.28</td><td style="text-align:left">1.20</td><td style="text-align:left">1.54</td></tr><tr><td style="text-align:left">q39a-v2.4</td><td style="text-align:left">6.60</td><td style="text-align:left">4.84</td><td style="text-align:left">4.36</td><td style="text-align:left"></td><td style="text-align:left">1.36</td><td style="text-align:left">1.11</td><td style="text-align:left">1.51</td></tr><tr><td style="text-align:left">q81-v2.4</td><td style="text-align:left">22.41</td><td style="text-align:left">20.14</td><td style="text-align:left">14.93</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.35</td><td style="text-align:left">1.50</td></tr><tr><td style="text-align:left">q69-v2.4</td><td style="text-align:left">7.81</td><td style="text-align:left">5.74</td><td style="text-align:left">5.26</td><td style="text-align:left"></td><td style="text-align:left">1.36</td><td style="text-align:left">1.09</td><td style="text-align:left">1.48</td></tr><tr><td style="text-align:left">q34-v2.4</td><td style="text-align:left">5.80</td><td style="text-align:left">4.76</td><td style="text-align:left">3.96</td><td style="text-align:left"></td><td style="text-align:left">1.22</td><td style="text-align:left">1.20</td><td style="text-align:left">1.47</td></tr><tr><td style="text-align:left">q97-v2.4</td><td style="text-align:left">19.76</td><td style="text-align:left">15.13</td><td style="text-align:left">13.60</td><td style="text-align:left"></td><td style="text-align:left">1.31</td><td style="text-align:left">1.11</td><td style="text-align:left">1.45</td></tr><tr><td style="text-align:left">q95-v2.4</td><td style="text-align:left">48.14</td><td style="text-align:left">38.24</td><td style="text-align:left">33.14</td><td style="text-align:left"></td><td style="text-align:left">1.26</td><td style="text-align:left">1.15</td><td style="text-align:left">1.45</td></tr><tr><td style="text-align:left">q22-v2.4</td><td style="text-align:left">9.79</td><td style="text-align:left">7.57</td><td style="text-align:left">6.81</td><td style="text-align:left"></td><td style="text-align:left">1.29</td><td style="text-align:left">1.11</td><td style="text-align:left">1.44</td></tr><tr><td style="text-align:left">q24b-v2.4</td><td style="text-align:left">71.09</td><td style="text-align:left">59.12</td><td style="text-align:left">49.64</td><td style="text-align:left"></td><td style="text-align:left">1.20</td><td style="text-align:left">1.19</td><td style="text-align:left">1.43</td></tr><tr><td style="text-align:left">q15-v2.4</td><td style="text-align:left">7.62</td><td style="text-align:left">6.30</td><td style="text-align:left">5.34</td><td style="text-align:left"></td><td style="text-align:left">1.21</td><td style="text-align:left">1.18</td><td style="text-align:left">1.43</td></tr><tr><td style="text-align:left">q58-v2.4</td><td style="text-align:left">5.05</td><td style="text-align:left">4.12</td><td style="text-align:left">3.57</td><td style="text-align:left"></td><td style="text-align:left">1.22</td><td style="text-align:left">1.16</td><td style="text-align:left">1.41</td></tr><tr><td style="text-align:left">q18-v2.4</td><td style="text-align:left">10.43</td><td style="text-align:left">8.45</td><td style="text-align:left">7.44</td><td style="text-align:left"></td><td style="text-align:left">1.23</td><td style="text-align:left">1.14</td><td style="text-align:left">1.40</td></tr><tr><td style="text-align:left">q14b-v2.4</td><td style="text-align:left">53.73</td><td style="text-align:left">40.88</td><td style="text-align:left">38.33</td><td style="text-align:left"></td><td style="text-align:left">1.31</td><td style="text-align:left">1.07</td><td style="text-align:left">1.40</td></tr><tr><td style="text-align:left">q72-v2.4</td><td style="text-align:left">22.29</td><td style="text-align:left">17.19</td><td style="text-align:left">16.08</td><td style="text-align:left"></td><td style="text-align:left">1.30</td><td style="text-align:left">1.07</td><td style="text-align:left">1.39</td></tr><tr><td style="text-align:left">q98-v2.4</td><td style="text-align:left">3.78</td><td style="text-align:left">3.26</td><td style="text-align:left">2.73</td><td style="text-align:left"></td><td style="text-align:left">1.16</td><td style="text-align:left">1.20</td><td style="text-align:left">1.39</td></tr><tr><td style="text-align:left">q46-v2.4</td><td style="text-align:left">13.37</td><td style="text-align:left">11.00</td><td style="text-align:left">9.65</td><td style="text-align:left"></td><td style="text-align:left">1.21</td><td style="text-align:left">1.14</td><td style="text-align:left">1.39</td></tr><tr><td style="text-align:left">q83-v2.4</td><td style="text-align:left">2.39</td><td style="text-align:left">1.95</td><td style="text-align:left">1.73</td><td style="text-align:left"></td><td style="text-align:left">1.22</td><td style="text-align:left">1.12</td><td style="text-align:left">1.38</td></tr><tr><td style="text-align:left">q6-v2.4</td><td style="text-align:left">11.11</td><td style="text-align:left">8.83</td><td style="text-align:left">8.08</td><td style="text-align:left"></td><td style="text-align:left">1.26</td><td style="text-align:left">1.09</td><td style="text-align:left">1.37</td></tr><tr><td style="text-align:left">q31-v2.4</td><td style="text-align:left">12.19</td><td style="text-align:left">11.12</td><td style="text-align:left">8.87</td><td style="text-align:left"></td><td style="text-align:left">1.10</td><td style="text-align:left">1.25</td><td style="text-align:left">1.37</td></tr><tr><td style="text-align:left">q11-v2.4</td><td style="text-align:left">23.95</td><td style="text-align:left">19.30</td><td style="text-align:left">17.72</td><td style="text-align:left"></td><td style="text-align:left">1.24</td><td style="text-align:left">1.09</td><td style="text-align:left">1.35</td></tr><tr><td style="text-align:left">q29-v2.4</td><td style="text-align:left">18.91</td><td style="text-align:left">15.29</td><td style="text-align:left">14.00</td><td style="text-align:left"></td><td style="text-align:left">1.24</td><td style="text-align:left">1.09</td><td style="text-align:left">1.35</td></tr><tr><td style="text-align:left">q61-v2.4</td><td style="text-align:left">5.26</td><td style="text-align:left">4.62</td><td style="text-align:left">3.92</td><td style="text-align:left"></td><td style="text-align:left">1.14</td><td style="text-align:left">1.18</td><td style="text-align:left">1.34</td></tr><tr><td style="text-align:left">q91-v2.4</td><td style="text-align:left">3.63</td><td style="text-align:left">3.05</td><td style="text-align:left">2.71</td><td style="text-align:left"></td><td style="text-align:left">1.19</td><td style="text-align:left">1.12</td><td style="text-align:left">1.34</td></tr><tr><td style="text-align:left">q5-v2.4</td><td style="text-align:left">20.57</td><td style="text-align:left">16.72</td><td style="text-align:left">15.42</td><td style="text-align:left"></td><td style="text-align:left">1.23</td><td style="text-align:left">1.08</td><td style="text-align:left">1.33</td></tr><tr><td style="text-align:left">q54-v2.4</td><td style="text-align:left">6.61</td><td style="text-align:left">5.61</td><td style="text-align:left">4.99</td><td style="text-align:left"></td><td style="text-align:left">1.18</td><td style="text-align:left">1.12</td><td style="text-align:left">1.32</td></tr><tr><td style="text-align:left">q23b-v2.4</td><td style="text-align:left">152.46</td><td style="text-align:left">130.94</td><td style="text-align:left">115.37</td><td style="text-align:left"></td><td style="text-align:left">1.16</td><td style="text-align:left">1.14</td><td style="text-align:left">1.32</td></tr><tr><td style="text-align:left">q51-v2.4</td><td style="text-align:left">11.90</td><td style="text-align:left">9.90</td><td style="text-align:left">9.06</td><td style="text-align:left"></td><td style="text-align:left">1.20</td><td style="text-align:left">1.09</td><td style="text-align:left">1.31</td></tr><tr><td style="text-align:left">q57-v2.4</td><td style="text-align:left">7.62</td><td style="text-align:left">6.19</td><td style="text-align:left">5.81</td><td style="text-align:left"></td><td style="text-align:left">1.23</td><td style="text-align:left">1.06</td><td style="text-align:left">1.31</td></tr><tr><td style="text-align:left">q10-v2.4</td><td style="text-align:left">8.38</td><td style="text-align:left">6.70</td><td style="text-align:left">6.41</td><td style="text-align:left"></td><td style="text-align:left">1.25</td><td style="text-align:left">1.05</td><td style="text-align:left">1.31</td></tr><tr><td style="text-align:left">q24a-v2.4</td><td style="text-align:left">75.07</td><td style="text-align:left">63.24</td><td style="text-align:left">57.78</td><td style="text-align:left"></td><td style="text-align:left">1.19</td><td style="text-align:left">1.09</td><td style="text-align:left">1.30</td></tr><tr><td style="text-align:left">q64-v2.4</td><td style="text-align:left">64.48</td><td style="text-align:left">53.92</td><td style="text-align:left">49.69</td><td style="text-align:left"></td><td style="text-align:left">1.20</td><td style="text-align:left">1.09</td><td style="text-align:left">1.30</td></tr><tr><td style="text-align:left">q3-v2.4</td><td style="text-align:left">3.39</td><td style="text-align:left">2.44</td><td style="text-align:left">2.62</td><td style="text-align:left"></td><td style="text-align:left">1.39</td><td style="text-align:left">0.93</td><td style="text-align:left">1.29</td></tr><tr><td style="text-align:left">q14a-v2.4</td><td style="text-align:left">61.18</td><td style="text-align:left">50.12</td><td style="text-align:left">47.37</td><td style="text-align:left"></td><td style="text-align:left">1.22</td><td style="text-align:left">1.06</td><td style="text-align:left">1.29</td></tr><tr><td style="text-align:left">q65-v2.4</td><td style="text-align:left">17.30</td><td style="text-align:left">14.65</td><td style="text-align:left">13.49</td><td style="text-align:left"></td><td style="text-align:left">1.18</td><td style="text-align:left">1.09</td><td style="text-align:left">1.28</td></tr><tr><td style="text-align:left">q17-v2.4</td><td style="text-align:left">6.95</td><td style="text-align:left">5.54</td><td style="text-align:left">5.44</td><td style="text-align:left"></td><td style="text-align:left">1.25</td><td style="text-align:left">1.02</td><td style="text-align:left">1.28</td></tr><tr><td style="text-align:left">q79-v2.4</td><td style="text-align:left">5.12</td><td style="text-align:left">4.14</td><td style="text-align:left">4.01</td><td style="text-align:left"></td><td style="text-align:left">1.24</td><td style="text-align:left">1.03</td><td style="text-align:left">1.28</td></tr><tr><td style="text-align:left">q47-v2.4</td><td style="text-align:left">8.45</td><td style="text-align:left">7.56</td><td style="text-align:left">6.62</td><td style="text-align:left"></td><td style="text-align:left">1.12</td><td style="text-align:left">1.14</td><td style="text-align:left">1.28</td></tr><tr><td style="text-align:left">q60-v2.4</td><td style="text-align:left">4.30</td><td style="text-align:left">3.72</td><td style="text-align:left">3.38</td><td style="text-align:left"></td><td style="text-align:left">1.16</td><td style="text-align:left">1.10</td><td style="text-align:left">1.27</td></tr><tr><td style="text-align:left">ss_max-v2.4</td><td style="text-align:left">10.48</td><td style="text-align:left">9.13</td><td style="text-align:left">8.29</td><td style="text-align:left"></td><td style="text-align:left">1.15</td><td style="text-align:left">1.10</td><td style="text-align:left">1.26</td></tr><tr><td style="text-align:left">q35-v2.4</td><td style="text-align:left">15.90</td><td style="text-align:left">13.96</td><td style="text-align:left">12.65</td><td style="text-align:left"></td><td style="text-align:left">1.14</td><td style="text-align:left">1.10</td><td style="text-align:left">1.26</td></tr><tr><td style="text-align:left">q68-v2.4</td><td style="text-align:left">7.93</td><td style="text-align:left">6.64</td><td style="text-align:left">6.32</td><td style="text-align:left"></td><td style="text-align:left">1.19</td><td style="text-align:left">1.05</td><td style="text-align:left">1.25</td></tr><tr><td style="text-align:left">q77-v2.4</td><td style="text-align:left">2.39</td><td style="text-align:left">1.95</td><td style="text-align:left">1.92</td><td style="text-align:left"></td><td style="text-align:left">1.23</td><td style="text-align:left">1.02</td><td style="text-align:left">1.25</td></tr><tr><td style="text-align:left">q75-v2.4</td><td style="text-align:left">38.27</td><td style="text-align:left">32.63</td><td style="text-align:left">30.71</td><td style="text-align:left"></td><td style="text-align:left">1.17</td><td style="text-align:left">1.06</td><td style="text-align:left">1.25</td></tr><tr><td style="text-align:left">q42-v2.4</td><td style="text-align:left">2.19</td><td style="text-align:left">1.96</td><td style="text-align:left">1.76</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.11</td><td style="text-align:left">1.24</td></tr><tr><td style="text-align:left">q25-v2.4</td><td style="text-align:left">5.64</td><td style="text-align:left">4.84</td><td style="text-align:left">4.55</td><td style="text-align:left"></td><td style="text-align:left">1.17</td><td style="text-align:left">1.06</td><td style="text-align:left">1.24</td></tr><tr><td style="text-align:left">q93-v2.4</td><td style="text-align:left">160.84</td><td style="text-align:left">142.63</td><td style="text-align:left">130.45</td><td style="text-align:left"></td><td style="text-align:left">1.13</td><td style="text-align:left">1.09</td><td style="text-align:left">1.23</td></tr><tr><td style="text-align:left">q38-v2.4</td><td style="text-align:left">16.80</td><td style="text-align:left">14.77</td><td style="text-align:left">13.66</td><td style="text-align:left"></td><td style="text-align:left">1.14</td><td style="text-align:left">1.08</td><td style="text-align:left">1.23</td></tr><tr><td style="text-align:left">q74-v2.4</td><td style="text-align:left">19.57</td><td style="text-align:left">16.73</td><td style="text-align:left">15.97</td><td style="text-align:left"></td><td style="text-align:left">1.17</td><td style="text-align:left">1.05</td><td style="text-align:left">1.23</td></tr><tr><td style="text-align:left">q82-v2.4</td><td style="text-align:left">14.10</td><td style="text-align:left">12.66</td><td style="text-align:left">11.55</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.10</td><td style="text-align:left">1.22</td></tr><tr><td style="text-align:left">q4-v2.4</td><td style="text-align:left">55.36</td><td style="text-align:left">49.70</td><td style="text-align:left">45.47</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.09</td><td style="text-align:left">1.22</td></tr><tr><td style="text-align:left">q23a-v2.4</td><td style="text-align:left">116.74</td><td style="text-align:left">101.45</td><td style="text-align:left">95.94</td><td style="text-align:left"></td><td style="text-align:left">1.15</td><td style="text-align:left">1.06</td><td style="text-align:left">1.22</td></tr><tr><td style="text-align:left">q30-v2.4</td><td style="text-align:left">15.69</td><td style="text-align:left">15.56</td><td style="text-align:left">12.91</td><td style="text-align:left"></td><td style="text-align:left">1.01</td><td style="text-align:left">1.21</td><td style="text-align:left">1.22</td></tr><tr><td style="text-align:left">q94-v2.4</td><td style="text-align:left">20.87</td><td style="text-align:left">17.87</td><td style="text-align:left">17.18</td><td style="text-align:left"></td><td style="text-align:left">1.17</td><td style="text-align:left">1.04</td><td style="text-align:left">1.21</td></tr><tr><td style="text-align:left">q71-v2.4</td><td style="text-align:left">3.83</td><td style="text-align:left">3.08</td><td style="text-align:left">3.16</td><td style="text-align:left"></td><td style="text-align:left">1.24</td><td style="text-align:left">0.98</td><td style="text-align:left">1.21</td></tr><tr><td style="text-align:left">q86-v2.4</td><td style="text-align:left">3.19</td><td style="text-align:left">2.89</td><td style="text-align:left">2.64</td><td style="text-align:left"></td><td style="text-align:left">1.10</td><td style="text-align:left">1.10</td><td style="text-align:left">1.21</td></tr><tr><td style="text-align:left">q26-v2.4</td><td style="text-align:left">5.94</td><td style="text-align:left">5.67</td><td style="text-align:left">4.91</td><td style="text-align:left"></td><td style="text-align:left">1.05</td><td style="text-align:left">1.15</td><td style="text-align:left">1.21</td></tr><tr><td style="text-align:left">q59-v2.4</td><td style="text-align:left">15.73</td><td style="text-align:left">14.35</td><td style="text-align:left">13.03</td><td style="text-align:left"></td><td style="text-align:left">1.10</td><td style="text-align:left">1.10</td><td style="text-align:left">1.21</td></tr><tr><td style="text-align:left">q27-v2.4</td><td style="text-align:left">7.15</td><td style="text-align:left">6.26</td><td style="text-align:left">5.93</td><td style="text-align:left"></td><td style="text-align:left">1.14</td><td style="text-align:left">1.06</td><td style="text-align:left">1.21</td></tr><tr><td style="text-align:left">q41-v2.4</td><td style="text-align:left">1.24</td><td style="text-align:left">1.09</td><td style="text-align:left">1.03</td><td style="text-align:left"></td><td style="text-align:left">1.14</td><td style="text-align:left">1.06</td><td style="text-align:left">1.20</td></tr><tr><td style="text-align:left">q36-v2.4</td><td style="text-align:left">6.15</td><td style="text-align:left">5.27</td><td style="text-align:left">5.11</td><td style="text-align:left"></td><td style="text-align:left">1.17</td><td style="text-align:left">1.03</td><td style="text-align:left">1.20</td></tr><tr><td style="text-align:left">q56-v2.4</td><td style="text-align:left">4.00</td><td style="text-align:left">3.46</td><td style="text-align:left">3.32</td><td style="text-align:left"></td><td style="text-align:left">1.15</td><td style="text-align:left">1.04</td><td style="text-align:left">1.20</td></tr><tr><td style="text-align:left">q87-v2.4</td><td style="text-align:left">15.46</td><td style="text-align:left">14.13</td><td style="text-align:left">12.96</td><td style="text-align:left"></td><td style="text-align:left">1.09</td><td style="text-align:left">1.09</td><td style="text-align:left">1.19</td></tr><tr><td style="text-align:left">q21-v2.4</td><td style="text-align:left">2.31</td><td style="text-align:left">2.11</td><td style="text-align:left">1.94</td><td style="text-align:left"></td><td style="text-align:left">1.09</td><td style="text-align:left">1.08</td><td style="text-align:left">1.19</td></tr><tr><td style="text-align:left">q32-v2.4</td><td style="text-align:left">2.04</td><td style="text-align:left">1.83</td><td style="text-align:left">1.73</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.06</td><td style="text-align:left">1.18</td></tr><tr><td style="text-align:left">q78-v2.4</td><td style="text-align:left">82.43</td><td style="text-align:left">75.70</td><td style="text-align:left">70.26</td><td style="text-align:left"></td><td style="text-align:left">1.09</td><td style="text-align:left">1.08</td><td style="text-align:left">1.17</td></tr><tr><td style="text-align:left">q88-v2.4</td><td style="text-align:left">40.39</td><td style="text-align:left">36.38</td><td style="text-align:left">34.44</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.06</td><td style="text-align:left">1.17</td></tr><tr><td style="text-align:left">q48-v2.4</td><td style="text-align:left">7.89</td><td style="text-align:left">7.24</td><td style="text-align:left">6.74</td><td style="text-align:left"></td><td style="text-align:left">1.09</td><td style="text-align:left">1.07</td><td style="text-align:left">1.17</td></tr><tr><td style="text-align:left">q33-v2.4</td><td style="text-align:left">4.06</td><td style="text-align:left">3.67</td><td style="text-align:left">3.47</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.06</td><td style="text-align:left">1.17</td></tr><tr><td style="text-align:left">q99-v2.4</td><td style="text-align:left">9.36</td><td style="text-align:left">8.36</td><td style="text-align:left">8.02</td><td style="text-align:left"></td><td style="text-align:left">1.12</td><td style="text-align:left">1.04</td><td style="text-align:left">1.17</td></tr><tr><td style="text-align:left">q16-v2.4</td><td style="text-align:left">28.35</td><td style="text-align:left">24.72</td><td style="text-align:left">24.41</td><td style="text-align:left"></td><td style="text-align:left">1.15</td><td style="text-align:left">1.01</td><td style="text-align:left">1.16</td></tr><tr><td style="text-align:left">q12-v2.4</td><td style="text-align:left">2.60</td><td style="text-align:left">2.64</td><td style="text-align:left">2.24</td><td style="text-align:left"></td><td style="text-align:left">0.98</td><td style="text-align:left">1.18</td><td style="text-align:left">1.16</td></tr><tr><td style="text-align:left">q28-v2.4</td><td style="text-align:left">41.47</td><td style="text-align:left">37.51</td><td style="text-align:left">35.84</td><td style="text-align:left"></td><td style="text-align:left">1.11</td><td style="text-align:left">1.05</td><td style="text-align:left">1.16</td></tr><tr><td style="text-align:left">q76-v2.4</td><td style="text-align:left">23.72</td><td style="text-align:left">21.55</td><td style="text-align:left">20.66</td><td style="text-align:left"></td><td style="text-align:left">1.10</td><td style="text-align:left">1.04</td><td style="text-align:left">1.15</td></tr><tr><td style="text-align:left">q1-v2.4</td><td style="text-align:left">6.24</td><td style="text-align:left">5.33</td><td style="text-align:left">5.43</td><td style="text-align:left"></td><td style="text-align:left">1.17</td><td style="text-align:left">0.98</td><td style="text-align:left">1.15</td></tr><tr><td style="text-align:left">q37-v2.4</td><td style="text-align:left">7.81</td><td style="text-align:left">7.18</td><td style="text-align:left">6.85</td><td style="text-align:left"></td><td style="text-align:left">1.09</td><td style="text-align:left">1.05</td><td style="text-align:left">1.14</td></tr><tr><td style="text-align:left">q90-v2.4</td><td style="text-align:left">9.91</td><td style="text-align:left">8.97</td><td style="text-align:left">8.77</td><td style="text-align:left"></td><td style="text-align:left">1.10</td><td style="text-align:left">1.02</td><td style="text-align:left">1.13</td></tr><tr><td style="text-align:left">q80-v2.4</td><td style="text-align:left">22.63</td><td style="text-align:left">20.72</td><td style="text-align:left">20.13</td><td style="text-align:left"></td><td style="text-align:left">1.09</td><td style="text-align:left">1.03</td><td style="text-align:left">1.12</td></tr><tr><td style="text-align:left">q66-v2.4</td><td style="text-align:left">8.09</td><td style="text-align:left">7.54</td><td style="text-align:left">7.23</td><td style="text-align:left"></td><td style="text-align:left">1.07</td><td style="text-align:left">1.04</td><td style="text-align:left">1.12</td></tr><tr><td style="text-align:left">q67-v2.4</td><td style="text-align:left">145.51</td><td style="text-align:left">140.91</td><td style="text-align:left">130.01</td><td style="text-align:left"></td><td style="text-align:left">1.03</td><td style="text-align:left">1.08</td><td style="text-align:left">1.12</td></tr><tr><td style="text-align:left">q7-v2.4</td><td style="text-align:left">7.82</td><td style="text-align:left">6.61</td><td style="text-align:left">7.00</td><td style="text-align:left"></td><td style="text-align:left">1.18</td><td style="text-align:left">0.94</td><td style="text-align:left">1.12</td></tr><tr><td style="text-align:left">q50-v2.4</td><td style="text-align:left">71.71</td><td style="text-align:left">70.06</td><td style="text-align:left">64.46</td><td style="text-align:left"></td><td style="text-align:left">1.02</td><td style="text-align:left">1.09</td><td style="text-align:left">1.11</td></tr><tr><td style="text-align:left">q19-v2.4</td><td style="text-align:left">4.61</td><td style="text-align:left">3.98</td><td style="text-align:left">4.16</td><td style="text-align:left"></td><td style="text-align:left">1.16</td><td style="text-align:left">0.96</td><td style="text-align:left">1.11</td></tr><tr><td style="text-align:left">q89-v2.4</td><td style="text-align:left">4.71</td><td style="text-align:left">4.53</td><td style="text-align:left">4.27</td><td style="text-align:left"></td><td style="text-align:left">1.04</td><td style="text-align:left">1.06</td><td style="text-align:left">1.10</td></tr><tr><td style="text-align:left">q13-v2.4</td><td style="text-align:left">8.75</td><td style="text-align:left">8.30</td><td style="text-align:left">7.98</td><td style="text-align:left"></td><td style="text-align:left">1.05</td><td style="text-align:left">1.04</td><td style="text-align:left">1.10</td></tr><tr><td style="text-align:left">q63-v2.4</td><td style="text-align:left">4.51</td><td style="text-align:left">4.36</td><td style="text-align:left">4.12</td><td style="text-align:left"></td><td style="text-align:left">1.03</td><td style="text-align:left">1.06</td><td style="text-align:left">1.10</td></tr><tr><td style="text-align:left">q85-v2.4</td><td style="text-align:left">14.98</td><td style="text-align:left">13.86</td><td style="text-align:left">13.72</td><td style="text-align:left"></td><td style="text-align:left">1.08</td><td style="text-align:left">1.01</td><td style="text-align:left">1.09</td></tr><tr><td style="text-align:left">q70-v2.4</td><td style="text-align:left">8.20</td><td style="text-align:left">8.28</td><td style="text-align:left">7.55</td><td style="text-align:left"></td><td style="text-align:left">0.99</td><td style="text-align:left">1.10</td><td style="text-align:left">1.09</td></tr><tr><td style="text-align:left">q62-v2.4</td><td style="text-align:left">8.97</td><td style="text-align:left">8.60</td><td style="text-align:left">8.28</td><td style="text-align:left"></td><td style="text-align:left">1.04</td><td style="text-align:left">1.04</td><td style="text-align:left">1.08</td></tr><tr><td style="text-align:left">q44-v2.4</td><td style="text-align:left">19.24</td><td style="text-align:left">18.94</td><td style="text-align:left">17.78</td><td style="text-align:left"></td><td style="text-align:left">1.02</td><td style="text-align:left">1.07</td><td style="text-align:left">1.08</td></tr><tr><td style="text-align:left">q84-v2.4</td><td style="text-align:left">9.72</td><td style="text-align:left">9.51</td><td style="text-align:left">9.01</td><td style="text-align:left"></td><td style="text-align:left">1.02</td><td style="text-align:left">1.05</td><td style="text-align:left">1.08</td></tr><tr><td style="text-align:left">q96-v2.4</td><td style="text-align:left">8.92</td><td style="text-align:left">8.26</td><td style="text-align:left">8.29</td><td style="text-align:left"></td><td style="text-align:left">1.08</td><td style="text-align:left">1.00</td><td style="text-align:left">1.08</td></tr><tr><td style="text-align:left">q9-v2.4</td><td style="text-align:left">34.46</td><td style="text-align:left">32.49</td><td style="text-align:left">32.07</td><td style="text-align:left"></td><td style="text-align:left">1.06</td><td style="text-align:left">1.01</td><td style="text-align:left">1.07</td></tr><tr><td style="text-align:left">q2-v2.4</td><td style="text-align:left">14.12</td><td style="text-align:left">13.05</td><td style="text-align:left">13.21</td><td style="text-align:left"></td><td style="text-align:left">1.08</td><td style="text-align:left">0.99</td><td style="text-align:left">1.07</td></tr><tr><td style="text-align:left">q52-v2.4</td><td style="text-align:left">2.00</td><td style="text-align:left">1.97</td><td style="text-align:left">1.87</td><td style="text-align:left"></td><td style="text-align:left">1.01</td><td style="text-align:left">1.05</td><td style="text-align:left">1.07</td></tr><tr><td style="text-align:left">q43-v2.4</td><td style="text-align:left">4.39</td><td style="text-align:left">4.14</td><td style="text-align:left">4.13</td><td style="text-align:left"></td><td style="text-align:left">1.06</td><td style="text-align:left">1.00</td><td style="text-align:left">1.06</td></tr><tr><td style="text-align:left">q92-v2.4</td><td style="text-align:left">1.53</td><td style="text-align:left">1.56</td><td style="text-align:left">1.46</td><td style="text-align:left"></td><td style="text-align:left">0.98</td><td style="text-align:left">1.07</td><td style="text-align:left">1.05</td></tr><tr><td style="text-align:left">q40-v2.4</td><td style="text-align:left">12.33</td><td style="text-align:left">11.43</td><td style="text-align:left">11.82</td><td style="text-align:left"></td><td style="text-align:left">1.08</td><td style="text-align:left">0.97</td><td style="text-align:left">1.04</td></tr><tr><td style="text-align:left">q49-v2.4</td><td style="text-align:left">26.01</td><td style="text-align:left">26.02</td><td style="text-align:left">25.04</td><td style="text-align:left"></td><td style="text-align:left">1.00</td><td style="text-align:left">1.04</td><td style="text-align:left">1.04</td></tr><tr><td style="text-align:left">q53-v2.4</td><td style="text-align:left">4.53</td><td style="text-align:left">4.64</td><td style="text-align:left">4.42</td><td style="text-align:left"></td><td style="text-align:left">0.98</td><td style="text-align:left">1.05</td><td style="text-align:left">1.03</td></tr><tr><td style="text-align:left">q55-v2.4</td><td style="text-align:left">2.36</td><td style="text-align:left">2.15</td><td style="text-align:left">2.50</td><td style="text-align:left"></td><td style="text-align:left">1.10</td><td style="text-align:left">0.86</td><td style="text-align:left">0.94</td></tr></tbody></table></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/benchmarks/spark-operator-benchmark/graviton-r-data.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/data-on-eks/docs/benchmarks/spark-operator-benchmark/running-the-benchmark"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Running the Benchmarks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/data-on-eks/docs/benchmarks/spark-operator-eks-benchmark"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kubeflow Spark Operator Benchmarks</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#results" class="table-of-contents__link toc-highlight">Results</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Get Started</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/data-on-eks/docs/introduction/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Get Involved</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with  at AWS  <br>  2025 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;7fbc7ab02fae4767b1af2588eba0cdf2&quot;}"></script></div>
</body>
</html>