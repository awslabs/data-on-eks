# EMR on EKS Driver Pod Template - EBS Hostpath Storage
# Uses EBS root volume for Spark shuffle data - suitable for non-SSD instance types
# The root volume provides /mnt/k8s-disks/0 directory for shuffle storage
apiVersion: v1
kind: Pod
metadata:
  name: emr-driver
  namespace: emr-data-team-a
spec:
  volumes:
    - name: spark-local-dir-1
      hostPath:
        path: /mnt/k8s-disks/0  # EBS Hostpath on root volume
        type: DirectoryOrCreate
  nodeSelector:
    # Use general-purpose nodepool with EBS storage
    NodeGroupType: general-purpose

  # Don't use "/mnt" path as mountPath with EMR pod Templates as its reserved
  initContainers:
    - name: volume-permission
      image: public.ecr.aws/docker/library/busybox
      # Grant volume access to hadoop user (UID 999, GID 1000)
      command: ['sh', '-c', 'mkdir -p /data1; chown -R 999:1000 /data1']
      volumeMounts:
        - name: spark-local-dir-1
          mountPath: /data1
  containers:
    - name: spark-kubernetes-driver # Don't change this name - EMR on EKS requires it
      volumeMounts:
        - name: spark-local-dir-1
          mountPath: /data1
          readOnly: false
