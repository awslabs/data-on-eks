apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: yunikorn
  namespace: argocd
  labels:
    category: data
    type: scheduling
spec:
  project: data-platform
  source:
    repoURL: https://apache.github.io/yunikorn-release
    chart: yunikorn
    targetRevision: "1.6.3"
    helm:
      values: |
        serviceAccount:
          create: true
          annotations: {}
        
        admission:
          replicaCount: 1
          
          nodeSelector:
            NodeGroupType: "core"
          
          tolerations:
            - key: "CriticalAddonsOnly"
              operator: "Exists"
          
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 200m
              memory: 256Mi
        
        scheduler:
          replicaCount: 1
          
          nodeSelector:
            NodeGroupType: "core"
          
          tolerations:
            - key: "CriticalAddonsOnly"
              operator: "Exists"
          
          resources:
            requests:
              cpu: 200m
              memory: 1Gi
            limits:
              cpu: 500m
              memory: 2Gi
          
          service:
            type: ClusterIP
            port: 9080
        
        web:
          replicaCount: 1
          
          nodeSelector:
            NodeGroupType: "core"
          
          tolerations:
            - key: "CriticalAddonsOnly"
              operator: "Exists"
          
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 200m
              memory: 256Mi
          
          service:
            type: ClusterIP
            port: 9889
        
        configuration: |
          partitions:
            - name: default
              placeholderrules:
                - name: "tg-placeholder-rule"
                  value: "spark-driver-{{ .applicationid }}"
                  create: true
                  filter:
                    type: allow
                    tags: "spark-app-selector:{{ .applicationid }}"
              queues:
                - name: "root"
                  submitacl: "*"
                  queues:
                    - name: "default"
                      resources:
                        guaranteed:
                          memory: 100G
                          vcore: 10
                        max:
                          memory: 1000G
                          vcore: 100
  
  destination:
    server: https://kubernetes.default.svc
    namespace: yunikorn
  
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true