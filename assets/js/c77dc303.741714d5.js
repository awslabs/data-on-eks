"use strict";(self.webpackChunkdoeks_website=self.webpackChunkdoeks_website||[]).push([[4669],{1589:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=i(4848),s=i(8453),t=(i(1470),i(9365),i(2450));const a={sidebar_position:2,sidebar_label:"Trino on EKS Best Practices"},o="Trino on EKS Best Practices",l={id:"bestpractices/analytics/trino-best-practices",title:"Trino on EKS Best Practices",description:"Trino deployment on Amazon Elastic Kubernetes Service (EKS) delivers distributed query processing with cloud-native scalability. Organizations can optimize costs by selecting specific compute instances and storage solutions that match their workload requirements while they  combine the power of Trino with the scalability and flexibility of EKS using Karpenter.",source:"@site/docs/bestpractices/analytics/trino-best-practices.md",sourceDirName:"bestpractices/analytics",slug:"/bestpractices/analytics/trino-best-practices",permalink:"/data-on-eks/docs/bestpractices/analytics/trino-best-practices",draft:!1,unlisted:!1,editUrl:"https://github.com/awslabs/data-on-eks/blob/main/website/docs/bestpractices/analytics/trino-best-practices.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Trino on EKS Best Practices"},sidebar:"bestpractices",previous:{title:"Data Analytics",permalink:"/data-on-eks/docs/category/data-analytics"},next:{title:"EMR on EKS Best Practices",permalink:"/data-on-eks/docs/bestpractices/analytics/emr-on-eks"}},c={},d=[{value:"Core Architecture",id:"core-architecture",level:3},{value:"Key Capabilities",id:"key-capabilities",level:3},{value:"Connectors Ecosystem",id:"connectors-ecosystem",level:3},{value:"Query Optimizations",id:"query-optimizations",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Creating the EKS Cluster",id:"creating-the-eks-cluster",level:2},{value:"EKS Add-ons",id:"eks-add-ons",level:3},{value:"Provisioning",id:"provisioning",level:3},{value:"Managed Node Groups for essential components",id:"managed-node-groups-for-essential-components",level:4},{value:"On-Demand Node Group",id:"on-demand-node-group",level:4},{value:"Spot Instance Node Group",id:"spot-instance-node-group",level:4},{value:"Additional Configurations",id:"additional-configurations",level:4},{value:"Karpenter for Node Scaling",id:"karpenter-for-node-scaling",level:3},{value:"Node Pool Setup",id:"node-pool-setup",level:4},{value:"Mixed Instances",id:"mixed-instances",level:3},{value:"Setup",id:"setup",level:2},{value:"Configuration Steps",id:"configuration-steps",level:3},{value:"Deployment",id:"deployment",level:3},{value:"The coordinator serves as the central management node that:",id:"the-coordinator-serves-as-the-central-management-node-that",level:4},{value:"Workers are execution nodes that:",id:"workers-are-execution-nodes-that",level:4},{value:"Trino Coordinator Configuration",id:"trino-coordinator-configuration",level:3},{value:"Resource Configuration sufficient for query planning and coordination tasks",id:"resource-configuration-sufficient-for-query-planning-and-coordination-tasks",level:4},{value:"High Availability Settings",id:"high-availability-settings",level:4},{value:"Exchange Manager Configuration",id:"exchange-manager-configuration",level:3},{value:"Configuring Exchange Manager with S3",id:"configuring-exchange-manager-with-s3",level:4},{value:"S3 Settings",id:"s3-settings",level:4},{value:"Recommendations",id:"recommendations",level:4},{value:"Trino Pod Resource Requests vs Limits",id:"trino-pod-resource-requests-vs-limits",level:2},{value:"Worker Pods",id:"worker-pods",level:3},{value:"Coordinator Pods",id:"coordinator-pods",level:3},{value:"Benefits of This Strategy",id:"benefits-of-this-strategy",level:3},{value:"AutoScaling Configuration",id:"autoscaling-configuration",level:3},{value:"Configuring Keda",id:"configuring-keda",level:4},{value:"File Caching",id:"file-caching",level:2},{value:"Compute Choices",id:"compute-choices",level:2},{value:"Plan for networking",id:"plan-for-networking",level:2},{value:"VPC CNI Addon",id:"vpc-cni-addon",level:3},{value:"Configuring the VPC CNI Addon",id:"configuring-the-vpc-cni-addon",level:3},{value:"Sample VPC CNI Configuration",id:"sample-vpc-cni-configuration",level:4},{value:"For more best practices related to Networking, refer to our Networking guide",id:"for-more-best-practices-related-to-networking-refer-to-our-networking-guide",level:4},{value:"Amazon S3 as Primary Storage",id:"amazon-s3-as-primary-storage",level:2},{value:"EBS Storage for Coordinator and Workers",id:"ebs-storage-for-coordinator-and-workers",level:3},{value:"Performance Optimization",id:"performance-optimization",level:3},{value:"Data Lifecycle Management",id:"data-lifecycle-management",level:3},{value:"Cost Optimization",id:"cost-optimization",level:3},{value:"Security and Compliance",id:"security-and-compliance",level:3},{value:"For detailed understanding of best practices related to S3, refer to the Best Practices for Trino with Amazon S3",id:"for-detailed-understanding-of-best-practices-related-to-s3-refer-to-the-best-practices-for-trino-with-amazon-s3",level:4},{value:"Hive Connector Configuration",id:"hive-connector-configuration",level:2},{value:"Hive Configuration Parameters",id:"hive-configuration-parameters",level:3},{value:"Sample Hive Catalog Configuration",id:"sample-hive-catalog-configuration",level:3},{value:"Metastore Configuration",id:"metastore-configuration",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Performance Optimizations",id:"performance-optimizations",level:3},{value:"Data Compression",id:"data-compression",level:3},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Iceberg Connector Configuration",id:"iceberg-connector-configuration",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:3},{value:"Sample Iceberg Catalog Configuration",id:"sample-iceberg-catalog-configuration",level:3},{value:"Catalog Configuration",id:"catalog-configuration",level:3},{value:"File Format",id:"file-format",level:4},{value:"Schema Evolution",id:"schema-evolution",level:4},{value:"Partitioning",id:"partitioning",level:4},{value:"Authentication",id:"authentication-1",level:4},{value:"Performance Optimizations",id:"performance-optimizations-1",level:3},{value:"Snapshot Management",id:"snapshot-management",level:4},{value:"Metadata Caching",id:"metadata-caching",level:4},{value:"Parallelism",id:"parallelism",level:4},{value:"Security Considerations",id:"security-considerations-1",level:3},{value:"Data Encryption",id:"data-encryption",level:4},{value:"Access Control",id:"access-control",level:4},{value:"Compliance",id:"compliance",level:4},{value:"Guide",id:"guide",level:2},{value:"Memory Management",id:"memory-management",level:3},{value:"Query Optimization",id:"query-optimization",level:3},{value:"Resource Management",id:"resource-management",level:3},{value:"Exchange Management",id:"exchange-management",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"trino-on-eks-best-practices",children:"Trino on EKS Best Practices"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://trino.io/",children:"Trino"})," deployment on ",(0,r.jsx)(n.a,{href:"https://aws.amazon.com/eks/",children:"Amazon Elastic Kubernetes Service"})," (EKS) delivers distributed query processing with cloud-native scalability. Organizations can optimize costs by selecting specific compute instances and storage solutions that match their workload requirements while they  combine the power of Trino with the scalability and flexibility of EKS using ",(0,r.jsx)(n.a,{href:"https://karpenter.sh/",children:"Karpenter"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This guide provides prescriptive guidance for deploying Trino on EKS. It focuses on achieving high scalability and low cost through optimal configurations, effective resource management, and cost-saving strategies. We cover detailed configurations for popular file formats such as Hive and Iceberg. These configurations ensure seamless data access and optimize performance. Our goal is to help you set up a Trino deployment that is both efficient and cost-effective."}),"\n",(0,r.jsxs)(n.p,{children:["We have a ",(0,r.jsx)(n.a,{href:"https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/trino",children:"deployment-ready blueprint"})," for deploying Trino on EKS, which incorporates the best practices discussed here."]}),"\n",(0,r.jsx)(n.p,{children:"Refer to these best practices for the rational and further optimization/fine-tuning."}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.h2,{children:(0,r.jsx)(n.span,{children:"Trino Fundamentals"})}),children:[(0,r.jsx)(n.p,{children:"This section covers Trino's core architecture, capabilities, use cases, and ecosystem with references."}),(0,r.jsx)(n.h3,{id:"core-architecture",children:"Core Architecture"}),(0,r.jsx)(n.p,{children:"Trino is a powerful distributed SQL query engine designed for high-performance analytics and big data processing. Some of the key components are"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Distributed coordinator-worker model"}),"\n",(0,r.jsx)(n.li,{children:"In-memory processing architecture"}),"\n",(0,r.jsx)(n.li,{children:"MPP (Massively Parallel Processing) execution"}),"\n",(0,r.jsx)(n.li,{children:"Dynamic query optimization engine"}),"\n",(0,r.jsxs)(n.li,{children:["More details can be found ",(0,r.jsx)(n.a,{href:"https://trino.io/docs/current/overview/concepts.html#architecture",children:"here"})]}),"\n"]}),(0,r.jsx)(n.h3,{id:"key-capabilities",children:"Key Capabilities"}),(0,r.jsx)(n.p,{children:"Trino offers several features that enhance data processing capabilities."}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Query Federation"}),"\n",(0,r.jsx)(n.li,{children:"Simultaneous queries across multiple data sources"}),"\n",(0,r.jsx)(n.li,{children:"Support for heterogeneous data environments"}),"\n",(0,r.jsx)(n.li,{children:"Real-time data processing capabilities"}),"\n",(0,r.jsx)(n.li,{children:"Unified SQL interface for diverse data sources"}),"\n"]}),(0,r.jsx)(n.h3,{id:"connectors-ecosystem",children:"Connectors Ecosystem"}),(0,r.jsx)(n.p,{children:"Trino enables SQL querying of diverse data sources by configuring a catalog with the appropriate connector and connecting through standard SQL clients."}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["50+ ",(0,r.jsx)(n.a,{href:"https://trino.io/ecosystem/data-source",children:"production-ready connectors"})," including:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cloud storage (AWS S3)"}),"\n",(0,r.jsx)(n.li,{children:"Relational databases (PostgreSQL, MySQL, SQL Server)"}),"\n",(0,r.jsx)(n.li,{children:"NoSQL stores (MongoDB, Cassandra)"}),"\n",(0,r.jsx)(n.li,{children:"Data lakes (Apache Hive, Apache Iceberg, Delta Lake)"}),"\n",(0,r.jsx)(n.li,{children:"Streaming platforms (Apache Kafka)"}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"query-optimizations",children:"Query Optimizations"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Advanced cost-based optimizer"}),"\n",(0,r.jsx)(n.li,{children:"Dynamic filtering"}),"\n",(0,r.jsx)(n.li,{children:"Adaptive query execution"}),"\n",(0,r.jsx)(n.li,{children:"Sophisticated memory management"}),"\n",(0,r.jsx)(n.li,{children:"Columnar processing support"}),"\n",(0,r.jsxs)(n.li,{children:["Read more ",(0,r.jsx)(n.a,{href:"https://trino.io/docs/current/optimizer.html",children:"here"})]}),"\n"]}),(0,r.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),(0,r.jsx)(n.p,{children:"Trino addresses these key use cases:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Interactive analytics"}),"\n",(0,r.jsx)(n.li,{children:"Data lake queries"}),"\n",(0,r.jsx)(n.li,{children:"ETL processing"}),"\n",(0,r.jsx)(n.li,{children:"Ad-hoc analysis"}),"\n",(0,r.jsx)(n.li,{children:"Real-time dashboards"}),"\n",(0,r.jsx)(n.li,{children:"Cross-platform data federation"}),"\n"]})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.h2,{children:(0,r.jsx)(n.span,{children:"EKS Cluster Configuration"})}),children:[(0,r.jsx)(n.h2,{id:"creating-the-eks-cluster",children:"Creating the EKS Cluster"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cluster Scope: Deploy the EKS cluster across multiple AZs for redundancy."}),"\n",(0,r.jsx)(n.li,{children:"Control Plane Logging: Enable control plane logging for audit and diagnostic purposes."}),"\n",(0,r.jsx)(n.li,{children:"Kubernetes Version: Use latest EKS version"}),"\n"]}),(0,r.jsx)(n.h3,{id:"eks-add-ons",children:"EKS Add-ons"}),(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html",children:"Amazon EKS-managed add-ons"})," through the EKS API instead of open-source Helm charts. The EKS team maintains these add-ons and automatically updates them to align with your EKS cluster versions."]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["VPC CNI: Install and configure the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html",children:"Amazon VPC CNI"})," plugin with custom settings to optimize IP address usage."]}),"\n",(0,r.jsx)(n.li,{children:"CoreDNS: Ensure CoreDNS is deployed for internal DNS resolution."}),"\n",(0,r.jsx)(n.li,{children:"KubeProxy: Deploy KubeProxy for Kubernetes network proxy functionality."}),"\n"]}),(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"When you are planning to launch a EKS cluster and deploy Trino follow these configuration details"})}),(0,r.jsx)(n.h3,{id:"provisioning",children:"Provisioning"}),(0,r.jsxs)(n.p,{children:["You can provision and scale underlying compute resources by using Karpenter or ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/managed-node-groups.html",children:"Managed Node Groups"})," (MNG)"]}),(0,r.jsx)(n.h4,{id:"managed-node-groups-for-essential-components",children:"Managed Node Groups for essential components"}),(0,r.jsx)(n.p,{children:"MNG uses Launch Templates, leverages Auto Scaling Groups, and integrates with Kubernetes Cluster Autoscaler."}),(0,r.jsx)(n.h4,{id:"on-demand-node-group",children:"On-Demand Node Group"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set up a managed node group for On-demand instances to run critical components like the Trino coordinator and at least one worker. This setup ensures stability and reliability for core operations.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use Case"}),": Ideal for running the Trino coordinator and an essential worker node."]}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"spot-instance-node-group",children:"Spot Instance Node Group"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Configure a managed node group for Spot instances to add additional worker nodes cost-effectively. Spot instances are suitable for handling variable workloads while reducing expenses.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use Case"}),": Best for scaling worker nodes for non SLA bound, cost-sensitive tasks."]}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"additional-configurations",children:"Additional Configurations"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single AZ Deployment"}),": Deploy node groups within a single Availability Zone to minimize data transfer costs and reduce latency."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Instance Types"}),": Select instance types that match your workload's needs, such as r6g.4xlarge for memory-intensive workloads."]}),"\n"]}),(0,r.jsx)(n.h3,{id:"karpenter-for-node-scaling",children:"Karpenter for Node Scaling"}),(0,r.jsx)(n.p,{children:"Karpenter provisions nodes in under 60 seconds, supports mixed instance/architecture, leverages native EC2 APIs, and offers dynamic resource allocation."}),(0,r.jsx)(n.h4,{id:"node-pool-setup",children:"Node Pool Setup"}),(0,r.jsx)(n.p,{children:"Use Karpenter to create a dynamic node pool that includes both spot and on-demand instances. Apply labels to ensure Trino workers and the coordinator are spun up on the appropriate instance types (on-demand or spot) as needed."}),(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:" Example Karpenter Node Pool with EC2 Graviton Instances"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'apiVersion: karpenter.sh/v1\nkind: NodePool\nmetadata:\nname: trino-sql-karpenter\nspec:\ntemplate:\nmetadata:\nlabels:\nNodePool: trino-sql-karpenter\nspec:\nnodeClassRef:\ngroup: karpenter.k8s.aws\nkind: EC2NodeClass\nname: trino-karpenter\nrequirements:\n- key: "karpenter.sh/capacity-type"\noperator: In\nvalues: ["on-demand"]\n- key: "kubernetes.io/arch\u201c\noperator: In\nvalues: ["arm64"]\n- key: "karpenter.k8s.aws/instance-category"\noperator: In\nvalues: ["r"]\n- key: "karpenter.k8s.aws/instance-family"\noperator: In\nvalues: ["r6g", "r7g", "r8g"]\n- key: "karpenter.k8s.aws/instance-size"\noperator: In\nvalues: ["2xlarge", "4xlarge"]\ndisruption:\nconsolidationPolicy: WhenEmptyOrUnderutilized\nconsolidateAfter: 60s\nlimits:\ncpu: "1000"\nmemory: 1000Gi\nweight: 100\n'})})]}),(0,r.jsxs)(n.p,{children:["Example of a Karpenter Node Pool setup can be also viewed in the ",(0,r.jsx)(n.a,{href:"https://github.com/awslabs/data-on-eks/blob/f8dda1ae530902b77ee123661265caa09d97969b/distributed-databases/trino/karpenter.tf#L100",children:"DoEKS repository"})," and the ",(0,r.jsx)(n.a,{href:"https://github.com/awslabs/data-on-eks/blob/f8dda1ae530902b77ee123661265caa09d97969b/distributed-databases/trino/karpenter.tf#L65",children:"EC2 Node Class configuration"}),"."]}),(0,r.jsx)(n.h3,{id:"mixed-instances",children:"Mixed Instances"}),(0,r.jsx)(n.p,{children:"Configure mixed instance types within the same instance pool to enhance flexibility and ensure access to a range of instance sizes, from small to large, based on workload demands."}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Karpenter: For better scaling and simplified management of Trino clusters, prefer using Karpenter. It provides faster node provisioning, enhanced flexibility with mixed instance types, and better resource efficiency. Karpenter delivers superior scaling capabilities compared to MNG, making it the preferred choice for scaling secondary(worker) nodes in analytics applications."}),"\n",(0,r.jsx)(n.li,{children:"Dedicated Nodes: Deploy one Trino pod per node to fully utilize available resources."}),"\n",(0,r.jsx)(n.li,{children:"DaemonSet Resource Allocation: Reserve enough CPU and memory for essential system DaemonSets to maintain node stability."}),"\n",(0,r.jsx)(n.li,{children:"Coordinator Placement: Always run the Trino coordinator on an on-demand node to guarantee reliability."}),"\n",(0,r.jsx)(n.li,{children:"Worker Distribution: Use a mix of On-Demand and Spot instances for worker nodes to balance cost-effectiveness with availability."}),"\n",(0,r.jsx)(n.li,{children:"Managed Node Groups Usage : MNG should be used for components of the workloads resiliency purposes and other components of the cluster like observability tools."}),"\n"]})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Trino on EKS Setup"})}),children:[(0,r.jsxs)(n.p,{children:["Helm streamlines your Trino deployment on EKS. We recommend installing through Helm using either the ",(0,r.jsx)(n.a,{href:"https://github.com/trinodb/charts",children:"official Helm chart"})," or community charts for configuration management."]}),(0,r.jsx)(n.h2,{id:"setup",children:"Setup"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Install Trino using the official Helm chart or community charts"}),"\n",(0,r.jsx)(n.li,{children:"Create distinct Helm releases for each cluster (ETL, Interactive, BI)"}),"\n"]}),(0,r.jsx)(n.h3,{id:"configuration-steps",children:"Configuration Steps"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Define unique ",(0,r.jsx)(n.code,{children:"values.yaml"})," files per cluster"]}),"\n",(0,r.jsxs)(n.li,{children:["Configure pod resources:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Set CPU/memory requests"}),"\n",(0,r.jsx)(n.li,{children:"Set CPU/memory limits"}),"\n",(0,r.jsx)(n.li,{children:"Specify coordinator resources"}),"\n",(0,r.jsx)(n.li,{children:"Specify worker resources"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Set pod scheduling:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configure nodeSelector"}),"\n",(0,r.jsx)(n.li,{children:"Configure affinity rules"}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"deployment",children:"Deployment"}),(0,r.jsx)(n.p,{children:"Use separate Helm configurations for each workload type, with their respective values files. For example"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# ETL Cluster\nhelm install etl-trino trino-chart -f etl-values.yaml\n\n# Interactive Cluster\nhelm install interactive-trino trino-chart -f interactive-values.yaml\n\n# BI Cluster\nhelm install analytics-trino trino-chart -f analytics-values.yaml\n"})}),(0,r.jsx)(n.p,{children:"Trino operates as a distributed query engine with a massively parallel processing (MPP) architecture. The system consists of two primary components: a coordinator and multiple workers."}),(0,r.jsx)(n.h4,{id:"the-coordinator-serves-as-the-central-management-node-that",children:"The coordinator serves as the central management node that:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Handles incoming queries"}),"\n",(0,r.jsx)(n.li,{children:"Parses and plans query execution"}),"\n",(0,r.jsx)(n.li,{children:"Schedules and monitors workloads"}),"\n",(0,r.jsx)(n.li,{children:"Manages worker nodes"}),"\n",(0,r.jsx)(n.li,{children:"Consolidates results for end-users"}),"\n"]}),(0,r.jsx)(n.h4,{id:"workers-are-execution-nodes-that",children:"Workers are execution nodes that:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Execute assigned tasks"}),"\n",(0,r.jsx)(n.li,{children:"Process data from various sources"}),"\n",(0,r.jsx)(n.li,{children:"Share intermediate results"}),"\n",(0,r.jsx)(n.li,{children:"Communicate with data source connectors"}),"\n",(0,r.jsx)(n.li,{children:"Register with the coordinator through a discovery service"}),"\n"]}),(0,r.jsx)(n.p,{children:"When deployed on EKS, both coordinator and worker components run as pods within an EKS cluster. The system stores schemas and references in a catalog, which enables access to various data sources through specialized connectors. This architecture enables Trino to distribute query processing across multiple nodes, resulting in improved performance and scalability for large-scale data operations."}),(0,r.jsx)(n.h3,{id:"trino-coordinator-configuration",children:"Trino Coordinator Configuration"}),(0,r.jsx)(n.p,{children:"Coordinators handle query planning and orchestration, requiring fewer resources than worker nodes. Coordinator pods need fewer resources than workers as they focus on query planning rather than data processing. Below are the key configuration settings for high availability and efficient resource usage."}),(0,r.jsx)(n.h4,{id:"resource-configuration-sufficient-for-query-planning-and-coordination-tasks",children:"Resource Configuration sufficient for query planning and coordination tasks"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Memory: 40Gi"}),"\n",(0,r.jsx)(n.li,{children:"CPU: 4-6 cores"}),"\n"]}),(0,r.jsx)(n.h4,{id:"high-availability-settings",children:"High Availability Settings"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Replicas: 2 coordinator instances"}),"\n",(0,r.jsx)(n.li,{children:"Pod Disruption Budget: Ensures coordinator availability during maintenance"}),"\n",(0,r.jsx)(n.li,{children:"Pod Anti-Affinity: Schedules coordinators on separate nodes"}),"\n",(0,r.jsx)(n.li,{children:"Always configure Pod Anti-Affinity to prevent multiple coordinators from running on the same node, improving fault tolerance."}),"\n"]}),(0,r.jsx)(n.h3,{id:"exchange-manager-configuration",children:"Exchange Manager Configuration"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Handles intermediate data during query execution."}),"\n",(0,r.jsx)(n.li,{children:"Offloads data to external storage to improve fault tolerance and scalability."}),"\n"]}),(0,r.jsx)(n.h4,{id:"configuring-exchange-manager-with-s3",children:"Configuring Exchange Manager with S3"}),(0,r.jsx)(n.h4,{id:"s3-settings",children:"S3 Settings"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set to ",(0,r.jsx)(n.code,{children:"s3://your-exchange-bucket"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"exchange.s3.region"}),": Set to your AWS region"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"exchange.s3.iam-role"}),": Use IAM roles for S3 access"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"exchange.s3.max-error-retries"}),": Increase for resilience"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"exchange.s3.upload.part-size"}),": Adjust to optimize performance (e.g., 64MB)"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"recommendations",children:"Recommendations"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Security - Ensure IAM roles have least privilege necessary"}),"\n",(0,r.jsxs)(n.li,{children:["Performance - Tune ",(0,r.jsx)(n.code,{children:"upload.part-size"})," and concurrent connections"]}),"\n",(0,r.jsx)(n.li,{children:"Cost Management - Monitor S3 costs and implement lifecycle policies"}),"\n"]}),(0,r.jsx)(n.h2,{id:"trino-pod-resource-requests-vs-limits",children:"Trino Pod Resource Requests vs Limits"}),(0,r.jsx)(n.p,{children:"Kubernetes uses resource requests and limits to manage container resources effectively. Here's how to optimize them for different Trino pod types:"}),(0,r.jsx)(n.h3,{id:"worker-pods",children:"Worker Pods"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Set resources.requests slightly lower than resources.limits (e.g., 10-20% difference)."}),"\n",(0,r.jsx)(n.li,{children:"This approach ensures efficient resource allocation while preventing resource exhaustion."}),"\n"]}),(0,r.jsx)(n.h3,{id:"coordinator-pods",children:"Coordinator Pods"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configure resource limits 20-30% higher than requests."}),"\n",(0,r.jsx)(n.li,{children:"This strategy accommodates occasional usage spikes, providing burst capacity while maintaining predictable scheduling."}),"\n"]}),(0,r.jsx)(n.h3,{id:"benefits-of-this-strategy",children:"Benefits of This Strategy"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Improves scheduling: Kubernetes makes informed decisions based on accurate resource requests, optimizing pod placement."}),"\n",(0,r.jsx)(n.li,{children:"Protects resources: Well-defined limits prevent resource exhaustion, safeguarding other cluster workloads."}),"\n",(0,r.jsx)(n.li,{children:"Handles bursts: Higher limits allow smooth management of transient resource spikes."}),"\n",(0,r.jsx)(n.li,{children:"Enhances stability: Appropriate resource allocation reduces the risk of pod evictions and improves overall cluster stability."}),"\n"]}),(0,r.jsx)(n.h3,{id:"autoscaling-configuration",children:"AutoScaling Configuration"}),(0,r.jsxs)(n.p,{children:["We recommend implementing ",(0,r.jsx)(n.a,{href:"https://keda.sh/",children:"KEDA"})," for event-driven scaling in Trino clusters to enable dynamic workload management. The combination of KEDA and Karpenter on Amazon EKS creates a powerful autoscaling solution that eliminates scaling challenges. While KEDA manages fine-grained pod scaling based on real-time metrics, Karpenter handles efficient node provisioning. Together, they replace manual scaling processes, delivering both improved performance and cost optimization."]}),(0,r.jsx)(n.h4,{id:"configuring-keda",children:"Configuring Keda"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add Keda helm release to the cluster"}),"\n",(0,r.jsx)(n.li,{children:"Add JVM / JMX Exporter configuration to Trino Helm value, enable serviceMonitor"}),"\n"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'configProperties: |-\n      hostPort: localhost:{{- .Values.jmx.registryPort }}\n      startDelaySeconds: 0\n      ssl: false\n      lowercaseOutputName: false\n      lowercaseOutputLabelNames: false\n      whitelistObjectNames: ["trino.execution:name=QueryManager","trino.execution:name=SqlTaskManager","trino.execution.executor:name=TaskExecutor","trino.memory:name=ClusterMemoryManager","java.lang:type=Runtime","trino.memory:type=ClusterMemoryPool,name=general","java.lang:type=Memory","trino.memory:type=MemoryPool,name=general"]\n      autoExcludeObjectNameAttributes: true\n      excludeObjectNameAttributes:\n        "java.lang:type=OperatingSystem":\n          - "ObjectName"\n        "java.lang:type=Runtime":\n          - "ClassPath"\n          - "SystemProperties"\n      rules:\n      - pattern: ".*"\n'})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Deploy KEDA scaledObject for trino, tracking CPU and QueuedQueries. The 'target' CPU percentage here is set at 85%, to leverage the physical cores of Graviton instances."}),"\n"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"triggers:\n  - type: cpu\n    metricType: Utilization\n    metadata:\n      value: '85'  # Target CPU utilization percentage\n  - type: prometheus\n    metricType: Value\n    metadata:\n      serverAddress: http://kube-prometheus-stack-prometheus.kube-prometheus-stack.svc.cluster.local:9090\n      threshold: '1'\n      metricName: queued_queries\n      query: sum by (job) (avg_over_time(trino_execution_QueryManager_QueuedQueries{job=\"trino\"}[1m]))\n"})}),(0,r.jsx)(n.h2,{id:"file-caching",children:"File Caching"}),(0,r.jsx)(n.p,{children:"File caching provides three major benefits to storage systems and query operations. First, it reduces the storage load by preventing repetitive retrievals of the same files, as cached files can be reused across multiple queries on the same worker. Second, it can significantly improve query performance by eliminating repeated network transfers and allowing access to local file copies, particularly beneficial when the original storage is in a different network or region. Finally, it leads to reduced query costs by minimizing network traffic and storage access."}),(0,r.jsx)(n.p,{children:"This is a basic configuration for implementing File Caching."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fs.cache.enabled=true\nfs.cache.directories=/tmp/cache/\nfs.cache.preferred-hosts-count=10 # The cluster size determines the host count. We recommend keeping host count small to maintain optimal performance.\n"})}),(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Configure instances with Local SSD storage for cache directories to significantly improve I/O speed and overall query performance."})})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.h2,{children:(0,r.jsx)(n.span,{children:"Compute, Storage, and Networking Best Practices"})}),children:[(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Compute Best Practices"})}),children:[(0,r.jsx)(n.h2,{id:"compute-choices",children:"Compute Choices"}),(0,r.jsxs)(n.p,{children:["Amazon Elastic Compute Cloud (EC2) offers diverse computing options through its instance families and processors, including standard, compute-optimized, memory-optimized, and I/O-optimized configurations. You can purchase these instances through ",(0,r.jsx)(n.a,{href:"https://aws.amazon.com/ec2/pricing/",children:"flexible pricing models"}),": On-Demand, Compute Savings Plan, Reserved, or Spot instances. Choosing the appropriate instance type optimizes your costs, maximizes performance, and supports sustainability goals. EKS enables you to match these compute resources precisely to your workload requirements. For Trino distributed clusters specifically, your compute selection directly impacts cluster performance."]}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.a,{href:"https://aws.amazon.com/ec2/graviton/",children:"AWS Graviton-based Instances"}),": Graviton instances lowers cost of instances while improving performance, it also helps to meet with sustainability goals"]}),"\n",(0,r.jsx)(n.li,{children:"Use Karpenter: For better scaling and simplified management of Trino clusters, prefer using Karpenter."}),"\n",(0,r.jsxs)(n.li,{children:["Diversify the Spot Instances to maximize your savings. ",(0,r.jsx)(n.a,{href:"https://aws.amazon.com/blogs/compute/best-practices-to-optimize-your-amazon-ec2-spot-instances-usage/",children:"More details can be found in EC2 Spot Best Practices"}),". Use ",(0,r.jsx)(n.a,{href:"http://localhost:3000/data-on-eks/docs/blueprints/distributed-databases/trino#example-3-optional-fault-tolerant-execution-in-trino",children:"Fault-Tolerant execution"})," with EC2 Spot Instances"]}),"\n"]})]}),(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Networking  Best Practices"})}),children:[(0,r.jsx)(n.h2,{id:"plan-for-networking",children:"Plan for networking"}),(0,r.jsx)(n.p,{children:"Trino's distributed nature across pods requires implementation of networking best practices to ensure optimal performance. Proper implementation improves resiliency, prevents IP exhaustion, reduces pod initialization errors, and minimizes latency. Pod networking forms the core of Kubernetes operations. Amazon EKS uses the VPC CNI plugin, operating in underlay mode where pods and hosts share the network layer. This ensures consistent IP addressing across both cluster and VPC environments."}),(0,r.jsx)(n.h3,{id:"vpc-cni-addon",children:"VPC CNI Addon"}),(0,r.jsx)(n.p,{children:"The Amazon VPC CNI plugin can be customized to manage IP address allocation efficiently. By default, the Amazon VPC CNI assigns two Elastic Network Interfaces (ENIs) per node. These ENIs reserve numerous IP addresses, particularly on larger instance types. Since Trino typically needs only one pod per node plus a few IP addresses for DaemonSet pods (for logging and networking), you can configure the CNI to limit IP address allocation and reduce overhead."}),(0,r.jsxs)(n.p,{children:["The following settings to the VPC CNI Addon can be applied using the EKS API, Terraform, or any other Infrastructure-as-Code (IaC) tool. For more in-depth details, refer to the official documentation",":VPC"," CNI Prefix and IP Target."]}),(0,r.jsx)(n.h3,{id:"configuring-the-vpc-cni-addon",children:"Configuring the VPC CNI Addon"}),(0,r.jsx)(n.p,{children:"Limit IP Addresses per Node by adjusting the configuration to allocate only the required number of IPs:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MINIMUM_IP_TARGET: Set this to the expected number of pods per node (e.g., 30)."}),"\n",(0,r.jsx)(n.li,{children:"WARM_IP_TARGET: Set to 1 to keep the warm IP pool minimal."}),"\n",(0,r.jsx)(n.li,{children:"ENABLE_PREFIX_DELEGATION: Improve IP address efficiency by assigning IP prefixes to worker nodes rather than individual secondary IP addresses. This approach reduces Network Address Usage (NAU) within your VPC by utilizing a smaller, more concentrated pool of IP addresses."}),"\n"]}),(0,r.jsx)(n.h4,{id:"sample-vpc-cni-configuration",children:"Sample VPC CNI Configuration"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'vpc-cni = {\n  preserve = true\n  configuration_values = jsonencode({\n    env = {\n      MINIMUM_IP_TARGET           = "30"\n      WARM_IP_TARGET              = "1"\n      ENABLE_PREFIX_DELEGATION    = "true"\n    }\n  })\n}\n'})}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)("b",{children:"Enable prefix delegation:"})," VPC CNI plugin supports prefix delegation, which assigns blocks of 16 IPv4 addresses (/28 prefix) to each node. This feature reduces the number of ENIs required per node. By using prefix delegation, you can lower your EC2 Network Address Usage (NAU), reduce network management complexity, and decrease operational costs."]}),(0,r.jsxs)(n.h4,{id:"for-more-best-practices-related-to-networking-refer-to-our-networking-guide",children:["For more best practices related to Networking, ",(0,r.jsx)(n.a,{href:"/data-on-eks/docs/bestpractices/networking/",children:"refer to our Networking guide"})]})]}),(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Storage Best Practices"})}),children:[(0,r.jsx)(n.p,{children:"This sections focuses on AWS services for optimal storage management with Trino on EKS."}),(0,r.jsx)(n.h2,{id:"amazon-s3-as-primary-storage",children:"Amazon S3 as Primary Storage"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use S3 Standard for frequently accessed data in Trino queries"}),"\n",(0,r.jsx)(n.li,{children:"Implement S3 Intelligent-Tiering for data with varying access patterns"}),"\n",(0,r.jsx)(n.li,{children:"Enable S3 server-side encryption (SSE-S3 or SSE-KMS) for data at rest"}),"\n",(0,r.jsx)(n.li,{children:"Configure appropriate bucket policies and access through IAM roles"}),"\n",(0,r.jsx)(n.li,{children:"Use S3 bucket prefixes strategically for better query performance"}),"\n",(0,r.jsx)(n.li,{children:"Use Trino with S3 Select to improve query performance"}),"\n",(0,r.jsx)(n.li,{}),"\n"]}),(0,r.jsx)(n.h3,{id:"ebs-storage-for-coordinator-and-workers",children:"EBS Storage for Coordinator and Workers"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use gp3 EBS volumes for better performance/cost ratio"}),"\n",(0,r.jsx)(n.li,{children:"Enable EBS encryption using KMS"}),"\n",(0,r.jsx)(n.li,{children:"Size EBS volumes based on spill directory requirements"}),"\n",(0,r.jsx)(n.li,{children:"Consider using EBS snapshots for backup strategy"}),"\n"]}),(0,r.jsx)(n.h3,{id:"performance-optimization",children:"Performance Optimization"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement S3 Select for improved query performance on specific workloads"}),"\n",(0,r.jsx)(n.li,{children:"Use AWS Partition Indexes for large datasets"}),"\n",(0,r.jsx)(n.li,{children:"Enable S3 request metrics in CloudWatch for monitoring"}),"\n",(0,r.jsx)(n.li,{children:"Configure appropriate read/write IOPS for gp3 volumes"}),"\n",(0,r.jsx)(n.li,{children:"Use S3 prefixes to partition data effectively"}),"\n"]}),(0,r.jsx)(n.h3,{id:"data-lifecycle-management",children:"Data Lifecycle Management"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement S3 Lifecycle policies for automated data management"}),"\n",(0,r.jsxs)(n.li,{children:["Use S3 Storage classes appropriately:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Standard for hot data"}),"\n",(0,r.jsx)(n.li,{children:"Intelligent-Tiering for variable access patterns"}),"\n",(0,r.jsx)(n.li,{children:"Standard-IA for less frequently accessed data"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Configure versioning for critical datasets"}),"\n"]}),(0,r.jsx)(n.h3,{id:"cost-optimization",children:"Cost Optimization"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use S3 storage class analysis to optimize storage costs"}),"\n",(0,r.jsx)(n.li,{children:"Monitor and optimize S3 request patterns"}),"\n",(0,r.jsx)(n.li,{children:"Implement S3 lifecycle policies to move older data to cheaper storage tiers"}),"\n",(0,r.jsx)(n.li,{children:"Use Cost Explorer to track storage spending"}),"\n"]}),(0,r.jsx)(n.h3,{id:"security-and-compliance",children:"Security and Compliance"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement VPC Endpoints for S3 access"}),"\n",(0,r.jsx)(n.li,{children:"Use AWS KMS for encryption key management"}),"\n",(0,r.jsx)(n.li,{children:"Enable S3 access logging for audit purposes"}),"\n",(0,r.jsx)(n.li,{children:"Configure appropriate IAM roles and policies"}),"\n",(0,r.jsx)(n.li,{children:"Enable AWS CloudTrail for API activity monitoring"}),"\n"]}),(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Remember to adjust these practices based on your specific workload characteristics and requirements."})}),(0,r.jsxs)(n.h4,{id:"for-detailed-understanding-of-best-practices-related-to-s3-refer-to-the-best-practices-for-trino-with-amazon-s3",children:["For detailed understanding of best practices related to S3, ",(0,r.jsx)(n.a,{href:"https://trino.io/assets/blog/trino-fest-2024/aws-s3.pdf",children:"refer to the Best Practices for Trino with Amazon S3"})]})]})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Configuring Trino Connectors"})}),children:[(0,r.jsx)(n.p,{children:"Trino connects to data sources through specialized adapters called connectors. The Hive and Iceberg connectors enable Trino to read columnar file formats like Parquet and ORC (Optimized Row Columnar). Proper connector configuration ensures optimal query performance and system compatibility."}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Isolation"}),": Use separate catalogs for different data sources or environments"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security"}),": Implement appropriate authentication and authorization mechanisms"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": Optimize connector settings based on data formats and query patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resource Management"}),": Adjust memory and CPU settings to match the workload requirements of each connector"]}),"\n"]}),(0,r.jsx)(n.p,{children:"Integrating Trino with file formats like Hive and Iceberg on Amazon EKS requires careful configuration and adherence to best practices. Set up connectors correctly and optimize resource allocation to ensure data access efficiency. Fine-tune query performance settings to achieve high scalability while keeping costs low. These steps are crucial for maximizing Trino's capabilities on EKS. Tailor configurations to your specific workloads, focusing on factors such as data volume and query complexity. Continuously monitor system performance and adjust settings as needed to maintain optimal results."}),(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Hive"})}),children:[(0,r.jsx)(n.h2,{id:"hive-connector-configuration",children:"Hive Connector Configuration"}),(0,r.jsx)(n.p,{children:"The Hive connector allows Trino to query data stored in a Hive data warehouse, typically using file formats like Parquet, ORC, or Avro stored on HDFS or Amazon S3."}),(0,r.jsx)(n.h3,{id:"hive-configuration-parameters",children:"Hive Configuration Parameters"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connector Name"}),": ",(0,r.jsx)(n.code,{children:"hive"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metastore"}),": Use AWS Glue Data Catalog as the metastore."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"File Formats"}),": Support for Parquet, ORC, Avro, and others."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"S3 Integration"}),": Configure S3 permissions for data access."]}),"\n"]}),(0,r.jsx)(n.h3,{id:"sample-hive-catalog-configuration",children:"Sample Hive Catalog Configuration"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"connector.name=hive\nhive.metastore=glue\nhive.metastore.glue.region=us-west-2\nhive.s3.aws-access-key=YOUR_ACCESS_KEY\nhive.s3.aws-secret-key=YOUR_SECRET_KEY\nhive.s3.iam-role=arn:aws:iam::123456789012:role/YourIAMRole\nhive.s3.endpoint=s3.us-west-2.amazonaws.com\nhive.s3.path-style-access=true\nhive.s3.ssl.enabled=true\nhive.security=legacy\n"})}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsx)(n.h3,{id:"metastore-configuration",children:"Metastore Configuration"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use AWS Glue as the Hive metastore for scalability and ease of management"}),"\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.code,{children:"hive.metastore=glue"})," and specify the region"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"authentication",children:"Authentication"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use IAM roles (",(0,r.jsx)(n.code,{children:"hive.s3.iam-role"}),") for secure access to S3"]}),"\n",(0,r.jsx)(n.li,{children:"Ensure the IAM role has the least privileges necessary"}),"\n"]}),(0,r.jsx)(n.h3,{id:"performance-optimizations",children:"Performance Optimizations"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Parquet and ORC"}),": Use columnar file formats like Parquet or ORC for better compression and query performance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Partitioning"}),": Partition tables based on frequently filtered columns to reduce query scan times"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Caching"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Enable metadata caching with ",(0,r.jsx)(n.code,{children:"hive.metastore-cache-ttl"})," to reduce metastore calls"]}),"\n",(0,r.jsxs)(n.li,{children:["Configure ",(0,r.jsx)(n.code,{children:"hive.file-status-cache-size"})," and ",(0,r.jsx)(n.code,{children:"hive.file-status-cache-ttl"})," for file status caching"]}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"data-compression",children:"Data Compression"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable compression for data stored in S3 to reduce storage costs and improve I/O performance"}),"\n"]}),(0,r.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Encryption"}),": Use server-side encryption (SSE) or client-side encryption for data at rest in S3"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Access Control"}),": Implement fine-grained access control using Ranger or AWS Lake Formation if necessary"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"SSL/TLS"})," Ensure ",(0,r.jsx)(n.code,{children:"hive.s3.ssl.enabled=true"})," to encrypt data in transit"]}),"\n"]}),"\n"]})]}),(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Iceberg"})}),children:[(0,r.jsx)(n.h2,{id:"iceberg-connector-configuration",children:"Iceberg Connector Configuration"}),(0,r.jsx)(n.p,{children:"The Iceberg connector allows Trino to interact with data stored in Apache Iceberg tables, which is designed for large analytic datasets and supports features like schema evolution and hidden partitioning."}),(0,r.jsx)(n.h3,{id:"configuration-parameters",children:"Configuration Parameters"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connector Name"}),": iceberg"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Catalog Type"}),": Use AWS Glue or Hive metastore"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"File Formats"}),": Parquet, ORC, or Avro"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"S3 Integration"}),": Configure S3 settings similar to the Hive connector"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"sample-iceberg-catalog-configuration",children:"Sample Iceberg Catalog Configuration"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",children:"connector.name=iceberg\niceberg.catalog.type=glue\niceberg.file-format=PARQUET\niceberg.catalog.glue.region=us-west-2\niceberg.catalog.glue.iam-role=arn:aws:iam::123456789012:role/YourIAMRole\niceberg.register-table-procedure.enabled=true\nhive.s3.aws-access-key=YOUR_ACCESS_KEY\nhive.s3.aws-secret-key=YOUR_SECRET_KEY\nhive.s3.iam-role=arn:aws:iam::123456789012:role/YourIAMRole\nhive.s3.endpoint=s3.us-west-2.amazonaws.com\nhive.s3.path-style-access=true\nhive.s3.ssl.enabled=true\n"})}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsx)(n.h3,{id:"catalog-configuration",children:"Catalog Configuration"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use AWS Glue as the catalog for centralized schema management"}),"\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.code,{children:"iceberg.catalog.type=glue"})," and specify the region"]}),"\n",(0,r.jsxs)(n.li,{children:["Use Iceberg REST Catalog protocol\n",(0,r.jsx)(n.code,{children:"iceberg.catalog.type=rest"}),"\n",(0,r.jsx)(n.code,{children:"iceberg.rest-catalog.uri=https://iceberg-with-rest:8181/'"})]}),"\n"]}),(0,r.jsx)(n.h4,{id:"file-format",children:"File Format"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Parquet or ORC for optimal performance"}),"\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.code,{children:"iceberg.file-format=PARQUET"})]}),"\n"]}),(0,r.jsx)(n.h4,{id:"schema-evolution",children:"Schema Evolution"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Iceberg supports schema evolution without table rewrites"}),"\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"iceberg.register-table-procedure.enabled=true"})," to allow table registration"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"partitioning",children:"Partitioning"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Utilize hidden partitioning features of Iceberg to simplify query syntax and improve performance"}),"\n"]}),(0,r.jsx)(n.h4,{id:"authentication-1",children:"Authentication"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use IAM roles for secure access to S3 and Glue"}),"\n",(0,r.jsx)(n.li,{children:"Ensure roles have necessary permissions for Iceberg operations"}),"\n"]}),(0,r.jsx)(n.h3,{id:"performance-optimizations-1",children:"Performance Optimizations"}),(0,r.jsx)(n.h4,{id:"snapshot-management",children:"Snapshot Management"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Regularly expire old snapshots to prevent performance degradation"}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"iceberg.expire-snapshots.min-snapshots-to-keep"})," and ",(0,r.jsx)(n.code,{children:"iceberg.expire-snapshots.max-ref-age"})," settings"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"metadata-caching",children:"Metadata Caching"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable caching to reduce calls to the metastore"}),"\n",(0,r.jsxs)(n.li,{children:["Adjust ",(0,r.jsx)(n.code,{children:"iceberg.catalog.cache-ttl"})," for caching duration"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"parallelism",children:"Parallelism"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configure split sizes and parallelism settings to optimize read performance"}),"\n",(0,r.jsxs)(n.li,{children:["Adjust ",(0,r.jsx)(n.code,{children:"iceberg.max-partitions-per-scan"})," and ",(0,r.jsx)(n.code,{children:"iceberg.max-splits-per-node"})]}),"\n"]}),(0,r.jsx)(n.h3,{id:"security-considerations-1",children:"Security Considerations"}),(0,r.jsx)(n.h4,{id:"data-encryption",children:"Data Encryption"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement encryption at rest and in transit"}),"\n"]}),(0,r.jsx)(n.h4,{id:"access-control",children:"Access Control"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Apply fine-grained permissions using IAM policies"}),"\n"]}),(0,r.jsx)(n.h4,{id:"compliance",children:"Compliance"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure compliance with data governance policies when using schema evolution features"}),"\n"]})]})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.span,{children:(0,r.jsx)(n.h2,{children:"Large Scale Query Optimizations"})}),children:[(0,r.jsx)(n.h2,{id:"guide",children:"Guide"}),(0,r.jsxs)(n.p,{children:["A generic huide for optimizing large-scale queries in Trino can be found below. For more details refer to ",(0,r.jsx)(n.a,{href:"https://trino.io/docs/current/optimizer.html",children:"query optimizer"})]}),(0,r.jsx)(n.h3,{id:"memory-management",children:"Memory Management"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure proper allocation from container to query level"}),"\n",(0,r.jsx)(n.li,{children:"Enable memory spilling with optimized thresholds"}),"\n"]}),(0,r.jsx)(n.h3,{id:"query-optimization",children:"Query Optimization"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Increase initialHashPartitions for better parallelism"}),"\n",(0,r.jsx)(n.li,{children:"Use automatic join distribution and reordering"}),"\n",(0,r.jsx)(n.li,{children:"Optimize split batch sizes for efficient processing"}),"\n"]}),(0,r.jsx)(n.h3,{id:"resource-management",children:"Resource Management"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enforce one pod per node for maximum resource utilization"}),"\n",(0,r.jsx)(n.li,{children:"Allocate sufficient CPU while reserving resources for system processes"}),"\n",(0,r.jsx)(n.li,{children:"Optimize garbage collection settings"}),"\n"]}),(0,r.jsx)(n.h3,{id:"exchange-management",children:"Exchange Management"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use S3 with optimized settings for exchange data"}),"\n",(0,r.jsx)(n.li,{children:"Increase concurrent connections and adjust upload part sizes"}),"\n"]}),(0,r.jsx)(n.admonition,{title:"Key Recommendations",type:"tip"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring"}),": Use tools like Prometheus and Grafana for real-time metrics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Testing"}),": Simulate workloads/run POCs to validate configurations before production"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Instance Selection"}),": Consider latest generation Graviton instances (Graviton3, Graviton4) for improved price-performance."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network Bandwidth"}),": Ensure instances provide adequate network bandwidth to prevent bottlenecks"]}),"\n"]})]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},9365:(e,n,i)=>{i.d(n,{A:()=>a});i(6540);var r=i(4164);const s={tabItem:"tabItem_Ymn6"};var t=i(4848);function a(e){let{children:n,hidden:i,className:a}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,a),hidden:i,children:n})}},1470:(e,n,i)=>{i.d(n,{A:()=>S});var r=i(6540),s=i(4164),t=i(3104),a=i(6347),o=i(205),l=i(7485),c=i(1682),d=i(679);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:i}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:i,attributes:r,default:s}}=e;return{value:n,label:i,attributes:r,default:s}}))}(i);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function p(e){let{value:n,tabValues:i}=e;return i.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:i}=e;const s=(0,a.W6)(),t=function(e){let{queryString:n=!1,groupId:i}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return i??null}({queryString:n,groupId:i});return[(0,l.aZ)(t),(0,r.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})}),[t,s])]}function g(e){const{defaultValue:n,queryString:i=!1,groupId:s}=e,t=u(e),[a,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:i}=e;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:i}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${i.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=i.find((e=>e.default))??i[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:t}))),[c,h]=m({queryString:i,groupId:s}),[g,f]=function(e){let{groupId:n}=e;const i=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,t]=(0,d.Dv)(i);return[s,(0,r.useCallback)((e=>{i&&t.set(e)}),[i,t])]}({groupId:s}),x=(()=>{const e=c??g;return p({value:e,tabValues:t})?e:null})();(0,o.A)((()=>{x&&l(x)}),[x]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),f(e)}),[h,f,t]),tabValues:t}}var f=i(2303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=i(4848);function v(e){let{className:n,block:i,selectedValue:r,selectValue:a,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),d=e=>{const n=e.currentTarget,i=l.indexOf(n),s=o[i].value;s!==r&&(c(n),a(s))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const i=l.indexOf(e.currentTarget)+1;n=l[i]??l[0];break}case"ArrowLeft":{const i=l.indexOf(e.currentTarget)-1;n=l[i]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":i},n),children:o.map((e=>{let{value:n,label:i,attributes:t}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>l.push(e),onKeyDown:h,onClick:d,...t,className:(0,s.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":r===n}),children:i??n},n)}))})}function y(e){let{lazy:n,children:i,selectedValue:t}=e;const a=(Array.isArray(i)?i:[i]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function b(e){const n=g(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,j.jsx)(v,{...n,...e}),(0,j.jsx)(y,{...n,...e})]})}function S(e){const n=(0,f.A)();return(0,j.jsx)(b,{...e,children:h(e.children)},String(n))}},2450:(e,n,i)=>{i.d(n,{A:()=>m});var r=i(6540),s=i(5556),t=i.n(s),a=i(4164);const o="collapsibleContent_q3kw",l="header_QCEw",c="icon_PckA",d="content_qLC1",h="expanded_iGsi";var u=i(4848);function p(e){let{children:n,header:i}=e;const[s,t]=(0,r.useState)(!1);return(0,u.jsxs)("div",{className:o,children:[(0,u.jsxs)("div",{className:(0,a.A)(l,{[h]:s}),onClick:()=>{t(!s)},children:[i,(0,u.jsx)("span",{className:(0,a.A)(c,{[h]:s}),children:s?"\ud83d\udc47":"\ud83d\udc48"})]}),s&&(0,u.jsx)("div",{className:d,children:n})]})}p.propTypes={children:t().node.isRequired,header:t().node.isRequired};const m=p},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);