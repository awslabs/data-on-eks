apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: default-affinity
spec:
  rules:
    - name: set-default-affinity
      match:
        resources:
          kinds:
            - Deployment
            - StatefulSet
            - DaemonSet
            - Pod
      exclude:
        resources:
          names:
            - trino-worker
      mutate:
        patchStrategicMerge:
          spec:
            template:
              spec:
                affinity:
                  nodeAffinity:
                    requiredDuringSchedulingIgnoredDuringExecution:
                      nodeSelectorTerms:
                        - matchExpressions:
                            - key: karpenter.sh/capacity-type
                              operator: NotIn
                              values:
                                - on-demand