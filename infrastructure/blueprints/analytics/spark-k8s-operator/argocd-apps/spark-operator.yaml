apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: spark-operator
  namespace: argocd
  labels:
    blueprint: spark-k8s-operator
    category: analytics
spec:
  project: data-platform
  source:
    repoURL: https://googlecloudplatform.github.io/spark-on-k8s-operator
    chart: spark-operator
    targetRevision: "2.2.0"
    helm:
      values: |
        controller:
          replicas: 1
          workers: 20
          batchScheduler:
            enable: false
        
        webhook:
          enabled: true
        
        spark:
          jobNamespaces:
            - default
            - spark-team-a
            - spark-team-b
            - spark-team-c
            - spark-s3-express
          serviceAccount:
            create: false
          rbac:
            create: false
        
        prometheus:
          metrics:
            enable: true
            port: 8080
            portName: metrics
            endpoint: /metrics
            prefix: ""
          podMonitor:
            create: true
            labels: {}
            jobLabel: spark-operator-podmonitor
            podMetricsEndpoint:
              scheme: http
              interval: 5s
  
  destination:
    server: https://kubernetes.default.svc
    namespace: spark-operator
  
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true